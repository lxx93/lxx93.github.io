<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Qt斗地主项目(下) | -lxxl-</title><meta name="author" content="lxx9339-T"><meta name="copyright" content="lxx9339-T"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1. 结束面板窗口类EndingPanel结束面板窗口类是用于在当一个玩家打完自己手中的牌时，也就意味着游戏结束。当结束的时候，会在主窗口的正中间跳入一个结束面板窗口，上面记录了各个玩家的得分。 结束分数面板窗口类：新建、c++、c++clase、类名为EndignPanel，基类为QWidget。 1.1 EndingPanel类头文件结束面板窗口类的头文件主要就是定义一些有关结束面板的私有变量">
<meta property="og:type" content="article">
<meta property="og:title" content="Qt斗地主项目(下)">
<meta property="og:url" content="https://lxx93.online/2024/08/08/Qt%E6%96%97%E5%9C%B0%E4%B8%BB%E9%A1%B9%E7%9B%AE(%E4%B8%8B)/index.html">
<meta property="og:site_name" content="-lxxl-">
<meta property="og:description" content="1. 结束面板窗口类EndingPanel结束面板窗口类是用于在当一个玩家打完自己手中的牌时，也就意味着游戏结束。当结束的时候，会在主窗口的正中间跳入一个结束面板窗口，上面记录了各个玩家的得分。 结束分数面板窗口类：新建、c++、c++clase、类名为EndignPanel，基类为QWidget。 1.1 EndingPanel类头文件结束面板窗口类的头文件主要就是定义一些有关结束面板的私有变量">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lxx93.online/img/23.png">
<meta property="article:published_time" content="2024-08-08T09:24:35.000Z">
<meta property="article:modified_time" content="2024-08-24T15:15:10.999Z">
<meta property="article:author" content="lxx9339-T">
<meta property="article:tag" content="Qt">
<meta property="article:tag" content="c++">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lxx93.online/img/23.png"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://lxx93.online/2024/08/08/Qt%E6%96%97%E5%9C%B0%E4%B8%BB%E9%A1%B9%E7%9B%AE(%E4%B8%8B)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":390},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":"50                //字数限制","languages":{"author":"作者: lxx9339-T","link":"链接: ","source":"来源: -lxxl-","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Qt斗地主项目(下)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-08-24 23:15:10'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><script async data-pjax src="/js/anzhiyu.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script><link rel="stylesheet" href="/css/music.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.css" /><link rel="stylesheet" href="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="-lxxl-" type="application/atom+xml">
</head><body><script>window.paceOptions = {
  restartOnPushState: false
}

document.addEventListener('pjax:send', () => {
  Pace.restart()
})
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.min.css"/><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avater.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">56</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/bangumis"><i class="fa-fw fas fas fa-video"></i><span> 追番</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/23.png')"><nav id="nav"><span id="blog-info"><a href="/" title="-lxxl-"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo1.png"/><span class="site-name">-lxxl-</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/bangumis"><i class="fa-fw fas fas fa-video"></i><span> 追番</span></a></li><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Qt斗地主项目(下)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-08T09:24:35.000Z" title="发表于 2024-08-08 17:24:35">2024-08-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-08-24T15:15:10.999Z" title="更新于 2024-08-24 23:15:10">2024-08-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%B0%8F%E9%A1%B9%E7%9B%AE/">小项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">16.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>63分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Qt斗地主项目(下)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="1-结束面板窗口类EndingPanel"><a href="#1-结束面板窗口类EndingPanel" class="headerlink" title="1. 结束面板窗口类EndingPanel"></a>1. 结束面板窗口类EndingPanel</h1><p>结束面板窗口类是用于在当一个玩家打完自己手中的牌时，也就意味着游戏结束。当结束的时候，会在主窗口的正中间跳入一个结束面板窗口，上面记录了各个玩家的得分。</p>
<p>结束分数面板窗口类：新建、c++、c++clase、类名为EndignPanel，基类为QWidget。</p>
<h2 id="1-1-EndingPanel类头文件"><a href="#1-1-EndingPanel类头文件" class="headerlink" title="1.1 EndingPanel类头文件"></a>1.1 EndingPanel类头文件</h2><p>结束面板窗口类的头文件主要就是定义一些有关结束面板的私有变量，如背景、按钮等。同时也定义一个关于是否继续游戏的信号。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">EndingPanel</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">EndingPanel</span><span class="params">(<span class="type">bool</span> isLord, <span class="type">bool</span> isWin, QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取玩家的得分，并显示</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPlayerScore</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> me)</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">continueGame</span><span class="params">()</span></span>;               <span class="comment">//添加一个自定义信号(点击继续按钮时，发出该信号)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *ev)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QPixmap m_bk;                     <span class="comment">//结束面板的背景</span></span><br><span class="line">    QLabel* m_title;                  <span class="comment">//地主赢或输、农民赢或输的标签</span></span><br><span class="line">    ScorePanel *m_score;              <span class="comment">//之前创建的分数窗口</span></span><br><span class="line">    QPushButton* m_continue;          <span class="comment">//继续游戏按钮</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="1-2-EndingPanel类函数实现"><a href="#1-2-EndingPanel类函数实现" class="headerlink" title="1.2 EndingPanel类函数实现"></a>1.2 EndingPanel类函数实现</h2><p>这部分就是对头文件定义的函数实现，通过构造函数，直接初始化完结束面板窗口上的所有内容</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">EndingPanel::<span class="built_in">EndingPanel</span>(<span class="type">bool</span> isLord, <span class="type">bool</span> isWin, QWidget *parent) : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    m_bk.<span class="built_in">load</span>(<span class="string">&quot;:/images/gameover.png&quot;</span>);            <span class="comment">//先把结束面板加载出来</span></span><br><span class="line">    <span class="built_in">setFixedSize</span>(m_bk.<span class="built_in">size</span>());                     <span class="comment">//设置大小为图片大小</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示用户玩家的角色以及游戏状态</span></span><br><span class="line">    m_title = <span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="keyword">this</span>);                    <span class="comment">//创建一个标签</span></span><br><span class="line">    <span class="keyword">if</span>(isLord &amp;&amp; isWin)&#123;                           <span class="comment">//如果用户是地主，且赢了，就在标签上加载对应的图</span></span><br><span class="line">        m_title-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/lord_win.png&quot;</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(isLord &amp; !isWin)&#123;</span><br><span class="line">        m_title-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/lord_fail.png&quot;</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!isLord &amp;&amp; isWin)&#123;</span><br><span class="line">        m_title-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/farmer_win.png&quot;</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!isLord &amp;&amp; !isWin)&#123;</span><br><span class="line">        m_title-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/farmer_fail.png&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    m_title-&gt;<span class="built_in">move</span>(<span class="number">125</span>,<span class="number">125</span>);                <span class="comment">//标签显示位置</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//分数面板</span></span><br><span class="line">    m_score = <span class="keyword">new</span> <span class="built_in">ScorePanel</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_score-&gt;<span class="built_in">move</span>(<span class="number">75</span>, <span class="number">230</span>);</span><br><span class="line">    m_score-&gt;<span class="built_in">setFixedSize</span>(<span class="number">260</span>, <span class="number">160</span>);              <span class="comment">//设置结束面板中，显示分数面板的大小</span></span><br><span class="line">    m_score-&gt;<span class="built_in">setMyFontColor</span>(ScorePanel::Red);     <span class="comment">//设置字体颜色为红色</span></span><br><span class="line">    m_score-&gt;<span class="built_in">setMyFontSize</span>(<span class="number">18</span>);                   <span class="comment">//设置字体大小为8</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//继续游戏按钮</span></span><br><span class="line">    m_continue = <span class="keyword">new</span> <span class="built_in">QPushButton</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_continue-&gt;<span class="built_in">move</span>(<span class="number">84</span>, <span class="number">429</span>);</span><br><span class="line">    QString style = <span class="string">R&quot;(</span></span><br><span class="line"><span class="string">            QPushButton&#123;border-image: url(:/images/button_normal.png)&#125;</span></span><br><span class="line"><span class="string">            QPushButton:hover&#123;border-image: url(:/images/button_hover.png)&#125;</span></span><br><span class="line"><span class="string">            QPushButton:pressed&#123;border-image: url(:/images/button_pressed.png)&#125;</span></span><br><span class="line"><span class="string">        )&quot;</span>;</span><br><span class="line">    m_continue-&gt;<span class="built_in">setStyleSheet</span>(style);</span><br><span class="line">    m_continue-&gt;<span class="built_in">setFixedSize</span>(<span class="number">231</span>,<span class="number">48</span>);       <span class="comment">//按钮大小</span></span><br><span class="line">    <span class="built_in">connect</span>(m_continue, &amp;QPushButton::clicked, <span class="keyword">this</span>, &amp;EndingPanel::continueGame);     <span class="comment">//发出信号</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EndingPanel::setPlayerScore</span><span class="params">(<span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span> me)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_score-&gt;<span class="built_in">setScores</span>(left, right, me);           <span class="comment">//直接调用左上角分数面板的设置分数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">EndingPanel::paintEvent</span><span class="params">(QPaintEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(ev);</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    p.<span class="built_in">drawPixmap</span>(<span class="built_in">rect</span>(), m_bk);         <span class="comment">//参1：这个图像要显示到哪个矩形区域里面</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="2-动画效果类AnimationWindow"><a href="#2-动画效果类AnimationWindow" class="headerlink" title="2. 动画效果类AnimationWindow"></a>2. 动画效果类AnimationWindow</h1><p>动画效果类主要就是负责在游戏构成中，在主窗口显示的一些动画。比如说当抢地主阶段，每个玩家的下注分数或不叫。和当有用户打出王炸、顺子、飞机等特殊牌型时，都会有触发一些动画，来提高游戏的体验感。</p>
<p>动画效果类创建：选择新建、c++、c++clase、类名为AnimationWindow，基类为QWidget。</p>
<h2 id="2-1-AnimationWindow类头文件"><a href="#2-1-AnimationWindow类头文件" class="headerlink" title="2.1 AnimationWindow类头文件"></a>2.1 AnimationWindow类头文件</h2><p>动画效果类的头文件定义了一些特殊牌型的动画显示函数和下注的分数显示函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AnimationWindow</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">Type</span>&#123;Sequence, Pair&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">AnimationWindow</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示下注分数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showBetScore</span><span class="params">(<span class="type">int</span> bet)</span></span>;</span><br><span class="line">    <span class="comment">//显示顺子和连对</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showSequence</span><span class="params">(Type type)</span></span>;</span><br><span class="line">    <span class="comment">//显示王炸</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showJokerBomb</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//显示炸弹</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showBomb</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//显示飞机</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showPlane</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent* ev)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QPixmap m_image;                <span class="comment">//加载图片的对象</span></span><br><span class="line">    <span class="type">int</span> m_index;</span><br><span class="line">    <span class="type">int</span> m_x;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="2-2-AnimationWindow类函数实现"><a href="#2-2-AnimationWindow类函数实现" class="headerlink" title="2.2 AnimationWindow类函数实现"></a>2.2 AnimationWindow类函数实现</h2><p>这不是是对AnimationWindow类头文件中定义的函数实现。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">AnimationWindow::<span class="built_in">AnimationWindow</span>(QWidget *parent) : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    m_x = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示分数窗口加载</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AnimationWindow::showBetScore</span><span class="params">(<span class="type">int</span> bet)</span>         <span class="comment">//主窗口创建AnimationWindow类对象后，会调用该函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_x = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(bet == <span class="number">1</span>)&#123;</span><br><span class="line">        m_image.<span class="built_in">load</span>(<span class="string">&quot;:/images/score1.png&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(bet == <span class="number">2</span>)&#123;</span><br><span class="line">        m_image.<span class="built_in">load</span>(<span class="string">&quot;:/images/score2.png&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(bet == <span class="number">3</span>)&#123;</span><br><span class="line">        m_image.<span class="built_in">load</span>(<span class="string">&quot;:/images/score3.png&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">update</span>();              <span class="comment">//将加载的图片显示到窗口</span></span><br><span class="line">    <span class="comment">//当抢地主完毕之后，就隐藏该显示分数这个窗口，也就是让被实例化的AnimationWindow对象调用hide方法</span></span><br><span class="line">    QTimer::<span class="built_in">singleShot</span>(<span class="number">2000</span>, <span class="keyword">this</span>, &amp;AnimationWindow::hide);        <span class="comment">//定时器只触发一次(一次性信号)，2秒钟后隐藏分数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AnimationWindow::showSequence</span><span class="params">(AnimationWindow::Type type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_x = <span class="number">0</span>;</span><br><span class="line">    QString name = type == Pair ? <span class="string">&quot;:/images/liandui.png&quot;</span> : <span class="string">&quot;:/images/shunzi.png&quot;</span>;      <span class="comment">//通过传进来的参数加载对应的图片</span></span><br><span class="line">    m_image.<span class="built_in">load</span>(name);</span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">    QTimer::<span class="built_in">singleShot</span>(<span class="number">2000</span>,<span class="keyword">this</span>,&amp;AnimationWindow::hide);               <span class="comment">//2s后隐藏动画</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AnimationWindow::showJokerBomb</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_index = <span class="number">0</span>;</span><br><span class="line">    m_x = <span class="number">0</span>;</span><br><span class="line">    QTimer* timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);                   <span class="comment">//创建定时器</span></span><br><span class="line">    <span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        m_index++;                        <span class="comment">//每进来一次,index++</span></span><br><span class="line">        <span class="keyword">if</span>(m_index &gt; <span class="number">8</span>)&#123;</span><br><span class="line">            timer-&gt;<span class="built_in">stop</span>();                <span class="comment">//然后大于8了，就停止定时器</span></span><br><span class="line">            timer-&gt;<span class="built_in">deleteLater</span>();         <span class="comment">//销毁回收定时器</span></span><br><span class="line">            m_index = <span class="number">8</span>;</span><br><span class="line">            <span class="built_in">hide</span>();                       <span class="comment">//隐藏动画</span></span><br><span class="line">        &#125;</span><br><span class="line">        QString name = <span class="built_in">QString</span>(<span class="string">&quot;:/images/joker_bomb_%1.png&quot;</span>).<span class="built_in">arg</span>(m_index);           <span class="comment">//拼接图片路径</span></span><br><span class="line">        m_image.<span class="built_in">load</span>(name);</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    timer-&gt;<span class="built_in">start</span>(<span class="number">60</span>);                                   <span class="comment">//指定间隔为60毫秒</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AnimationWindow::showBomb</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_index = <span class="number">0</span>;</span><br><span class="line">    m_x = <span class="number">0</span>;</span><br><span class="line">    QTimer* timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);                   <span class="comment">//创建定时器</span></span><br><span class="line">    <span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        m_index++;                        <span class="comment">//每进来一次,index++</span></span><br><span class="line">        <span class="keyword">if</span>(m_index &gt; <span class="number">12</span>)&#123;</span><br><span class="line">            timer-&gt;<span class="built_in">stop</span>();                <span class="comment">//然后大于12了，就停止定时器</span></span><br><span class="line">            timer-&gt;<span class="built_in">deleteLater</span>();         <span class="comment">//销毁回收定时器</span></span><br><span class="line">            m_index = <span class="number">12</span>;</span><br><span class="line">            <span class="built_in">hide</span>();                       <span class="comment">//隐藏动画</span></span><br><span class="line">        &#125;</span><br><span class="line">        QString name = <span class="built_in">QString</span>(<span class="string">&quot;:/images/bomb_%1.png&quot;</span>).<span class="built_in">arg</span>(m_index);           <span class="comment">//拼接图片路径</span></span><br><span class="line">        m_image.<span class="built_in">load</span>(name);</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    timer-&gt;<span class="built_in">start</span>(<span class="number">60</span>);                                   <span class="comment">//指定间隔为60毫秒</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AnimationWindow::showPlane</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_x = <span class="built_in">width</span>();                                  <span class="comment">//x轴就默认为动画窗口的宽度</span></span><br><span class="line">    m_image.<span class="built_in">load</span>(<span class="string">&quot;:/images/plane_1.png&quot;</span>);</span><br><span class="line">    <span class="built_in">setFixedHeight</span>(m_image.<span class="built_in">height</span>());               <span class="comment">//y轴就为图片的高度</span></span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> step = <span class="built_in">width</span>() / <span class="number">5</span>;                        <span class="comment">//将宽度分为5份，得到5份取区间</span></span><br><span class="line">    QTimer* timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(timer, &amp;QTimer::timeout, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> dist = <span class="number">0</span>;                       <span class="comment">//飞机移动的距离</span></span><br><span class="line">        <span class="type">static</span> <span class="type">int</span> timers = <span class="number">0</span>;</span><br><span class="line">        dist += <span class="number">5</span>;</span><br><span class="line">        <span class="keyword">if</span>(dist&gt;=step)&#123;                            <span class="comment">//如果满足，说明某一个区间已经走完了,就进入下一个区间</span></span><br><span class="line">            dist = <span class="number">0</span>;</span><br><span class="line">            timers++;</span><br><span class="line">            QString name = <span class="built_in">QString</span>(<span class="string">&quot;:/images/plane_%1.png&quot;</span>).<span class="built_in">arg</span>(timers%<span class="number">5</span>+<span class="number">1</span>);      <span class="comment">//图片在1到5之间切换</span></span><br><span class="line">            m_image.<span class="built_in">load</span>(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(m_x &lt;= <span class="number">-110</span>)&#123;                <span class="comment">//当飞机飞出动画窗口，就结束</span></span><br><span class="line">            timer-&gt;<span class="built_in">stop</span>();</span><br><span class="line">            timer-&gt;<span class="built_in">deleteLater</span>();</span><br><span class="line">            dist = timers = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">hide</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        m_x -= <span class="number">5</span>;              <span class="comment">//每次往左走5像素</span></span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">    timer-&gt;<span class="built_in">start</span>(<span class="number">15</span>);             <span class="comment">//每个15毫秒执行一次，画一次</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">AnimationWindow::paintEvent</span><span class="params">(QPaintEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(ev);               <span class="comment">//处理ev参数没有使用的警告</span></span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    <span class="comment">//因为对于飞机动画来说，m_x是移动的，而其它动画不移动，所以就把m_x初始化为0</span></span><br><span class="line">    p.<span class="built_in">drawPixmap</span>(m_x,<span class="number">0</span>,m_image.<span class="built_in">width</span>(),m_image.<span class="built_in">height</span>(),m_image);        <span class="comment">//加载的图片在窗口中的位置x和y；宽度和高度；QPixmap对象</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-闹钟窗口类CountDown"><a href="#3-闹钟窗口类CountDown" class="headerlink" title="3. 闹钟窗口类CountDown"></a>3. 闹钟窗口类CountDown</h1><p>闹钟窗口类主要是在主窗口为用户玩家创建了一个定时闹钟，轮到用户玩家出牌阶段，用户玩家只能在指定的时间内完成出牌或不出，当15秒过后，就默认玩家放弃出牌。当然，闹钟会起作用的前提是玩家必须出牌阶段，比如说当玩家抢完地主后或出牌后，没有前提玩家出牌，又该自己出时，这两种情况闹钟是不会出现的，其他情况，闹钟都会起作用。</p>
<p>闹钟窗口类：新建、c、c++、类名为<code>CountDown</code>，基类为QWidget</p>
<h2 id="3-1-CountDown类头文件"><a href="#3-1-CountDown类头文件" class="headerlink" title="3.1 CountDown类头文件"></a>3.1 CountDown类头文件</h2><p>闹钟窗口类CountDown的头文件就是定义了闹钟的图像对象和倒计时数字的图片对象，又定义显示闹钟函数来完成对应的操作。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CountDown</span> : <span class="keyword">public</span> QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">CountDown</span><span class="params">(QWidget *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showCountDown</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stopCountDown</span><span class="params">()</span></span>; <span class="comment">//终止倒计时的(当闹钟的秒数还没有读到0，但用户玩家已经将牌打出去了，这种情况也需要终止倒计时)</span></span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">notMuchTime</span><span class="params">()</span></span>;                 <span class="comment">//当闹钟的秒数减到5时，向主界面发送提醒信号</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">timeout</span><span class="params">()</span></span>;                     <span class="comment">//当闹钟的秒数减到0时，向主界面发送信号(切换当前玩家为下一个玩家)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent *ev)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    QPixmap m_clock;                <span class="comment">//加载闹钟图片对象</span></span><br><span class="line">    QPixmap m_number;               <span class="comment">//加载闹钟上的数字对象</span></span><br><span class="line">    QTimer* m_timer;</span><br><span class="line">    <span class="type">int</span>  m_count;                   <span class="comment">//倒计时的总时长</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-CountDown类函数实现"><a href="#3-2-CountDown类函数实现" class="headerlink" title="3.2 CountDown类函数实现"></a>3.2 CountDown类函数实现</h2><p>这部分就是对CountDown类头文件中定义的函数实现。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">CountDown::<span class="built_in">CountDown</span>(QWidget *parent) : <span class="built_in">QWidget</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">setFixedSize</span>(<span class="number">70</span>,<span class="number">70</span>);               <span class="comment">//给当前闹钟窗口显示固定大小(与图片大小一样)</span></span><br><span class="line">    m_timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(m_timer, &amp;QTimer::timeout, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        m_count--;                         <span class="comment">//每次-1</span></span><br><span class="line">        <span class="keyword">if</span>(m_count&lt;<span class="number">10</span> &amp;&amp; m_count&gt;<span class="number">0</span>)&#123;       <span class="comment">//当count大于0小于10时，显示闹钟出来</span></span><br><span class="line">            m_clock.<span class="built_in">load</span>(<span class="string">&quot;:/images/clock.png&quot;</span>);</span><br><span class="line">            <span class="comment">//加载数字到闹钟上，数字的宽度是30像素，间隙是10个像素，从后从30*42像素缩放成20*30像素</span></span><br><span class="line">            m_number = <span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/number.png&quot;</span>).<span class="built_in">copy</span>(m_count*(<span class="number">30</span>+<span class="number">10</span>), <span class="number">0</span>, <span class="number">30</span>, <span class="number">42</span>).<span class="built_in">scaled</span>(<span class="number">20</span>,<span class="number">30</span>);   <span class="comment">//x轴上是从远到近</span></span><br><span class="line">            <span class="keyword">if</span>(m_count == <span class="number">5</span>)&#123;</span><br><span class="line">                emit <span class="built_in">notMuchTime</span>();         <span class="comment">//当秒数减为5时，发出信号(播放提示音乐)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(m_count &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            m_clock = <span class="built_in">QPixmap</span>();                <span class="comment">//将闹钟设置成空值(不显示了)</span></span><br><span class="line">            m_number = <span class="built_in">QPixmap</span>();               <span class="comment">//将数字设置成空值(不显示了)</span></span><br><span class="line">            m_timer-&gt;<span class="built_in">stop</span>();                    <span class="comment">//停掉定时器</span></span><br><span class="line">            emit <span class="built_in">timeout</span>();                     <span class="comment">//发出信号(切换当前玩家)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">update</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CountDown::showCountDown</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_count = <span class="number">15</span>;</span><br><span class="line">    m_timer-&gt;<span class="built_in">start</span>(<span class="number">1000</span>);                <span class="comment">//启动定时器(每隔1s切换闹钟里面的数字)</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CountDown::stopCountDown</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_timer-&gt;<span class="built_in">stop</span>();                    <span class="comment">//停掉定时器</span></span><br><span class="line">    m_clock = <span class="built_in">QPixmap</span>();                <span class="comment">//将闹钟设置成空值(不显示了)</span></span><br><span class="line">    m_number = <span class="built_in">QPixmap</span>();               <span class="comment">//将数字设置成空值(不显示了)</span></span><br><span class="line">    <span class="built_in">update</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CountDown::paintEvent</span><span class="params">(QPaintEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(ev);               <span class="comment">//处理ev参数没有使用的警告</span></span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    p.<span class="built_in">drawPixmap</span>(<span class="built_in">rect</span>(), m_clock);                                       <span class="comment">//绘制闹钟</span></span><br><span class="line">    p.<span class="built_in">drawPixmap</span>(<span class="number">24</span>,<span class="number">24</span>,m_number.<span class="built_in">width</span>(),m_number.<span class="built_in">height</span>(),m_number);     <span class="comment">//绘制数字</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-背景音乐类BGMControl"><a href="#4-背景音乐类BGMControl" class="headerlink" title="4. 背景音乐类BGMControl"></a>4. 背景音乐类BGMControl</h1><p>背景音乐类是负责整个游戏的一个配音，有的是循环一直播放，有的是只播放一次。比如说游戏的背景音乐就是一直播放，我们出牌时，男生和女生的声音就是只一次播放，还有一写特殊牌型的声音也是只播放一次，如飞机、炸弹等。</p>
<p>背景音乐类：新建、c++、c++clase、类名为BGMControl、基类为QObject。</p>
<h2 id="4-1-BGMControl类头文件"><a href="#4-1-BGMControl类头文件" class="headerlink" title="4.1 BGMControl类头文件"></a>4.1 BGMControl类头文件</h2><p>背景音乐类的头文件定义了一个牌型的枚举类，它与文件中的json文件里面的配音目录顺序一致，这样方便在程序中调用。同时定义了在不同情况下，播放不同的音乐函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BGMControl</span> : <span class="keyword">public</span> QObject</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">RoleSex</span>&#123;Man, Woman&#125;;</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">CardType</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 单张牌</span></span><br><span class="line">            Three,</span><br><span class="line">            Foue,</span><br><span class="line">            Five,</span><br><span class="line">            Six,</span><br><span class="line">            Seven,</span><br><span class="line">            Eight,</span><br><span class="line">            Nine,</span><br><span class="line">            Ten,</span><br><span class="line">            Jack,</span><br><span class="line">            Queen,</span><br><span class="line">            King,</span><br><span class="line">            Ace,</span><br><span class="line">            Tow,</span><br><span class="line">            SmallJoker,</span><br><span class="line">            BigJoker,</span><br><span class="line">            <span class="comment">// 两张牌</span></span><br><span class="line">            Three_Double,</span><br><span class="line">            Foue_Double,</span><br><span class="line">            Five_Double,</span><br><span class="line">            Six_Double,</span><br><span class="line">            Seven_Double,</span><br><span class="line">            Eight_Double,</span><br><span class="line">            Nine_Double,</span><br><span class="line">            Ten_Double,</span><br><span class="line">            Jack_Double,</span><br><span class="line">            Queen_Double,</span><br><span class="line">            King_Double,</span><br><span class="line">            Ace_Double ,</span><br><span class="line">            Tow_Double,</span><br><span class="line">            <span class="comment">// 三张牌</span></span><br><span class="line">            Three_Triple,</span><br><span class="line">            Foue_Triple,</span><br><span class="line">            Five_Triple,</span><br><span class="line">            Six_Triple,</span><br><span class="line">            Seven_Triple,</span><br><span class="line">            Eight_Triple,</span><br><span class="line">            Nine_Triple,</span><br><span class="line">            Ten_Triple,</span><br><span class="line">            Jack_Triple,</span><br><span class="line">            Queen_Triple,</span><br><span class="line">            King_Triple,</span><br><span class="line">            Ace_Triple,</span><br><span class="line">            Tow_Triple,</span><br><span class="line">            <span class="comment">// 其他组合</span></span><br><span class="line">            Plane,          <span class="comment">// 飞机</span></span><br><span class="line">            SequencePair,   <span class="comment">// 连对</span></span><br><span class="line">            ThreeBindOne,   <span class="comment">// 三带一</span></span><br><span class="line">            ThreeBindPair,  <span class="comment">// 三带一对</span></span><br><span class="line">            Sequence,       <span class="comment">// 顺子</span></span><br><span class="line">            FourBindTwo,    <span class="comment">// 四带二(单张)</span></span><br><span class="line">            FourBind2Pair,  <span class="comment">// 四带两对</span></span><br><span class="line">            Bomb,           <span class="comment">// 炸弹</span></span><br><span class="line">            JokerBomb,      <span class="comment">// 王炸</span></span><br><span class="line">            Pass1,          <span class="comment">// 过</span></span><br><span class="line">            Pass2,</span><br><span class="line">            Pass3,</span><br><span class="line">            Pass4,</span><br><span class="line">            MoreBiger1,     <span class="comment">// 大你</span></span><br><span class="line">            MoreBiger2,</span><br><span class="line">            Biggest,        <span class="comment">// 压死</span></span><br><span class="line">            <span class="comment">// 抢地主</span></span><br><span class="line">            NoOrder,        <span class="comment">// 不叫</span></span><br><span class="line">            NoRob,          <span class="comment">// 不抢</span></span><br><span class="line">            Order,          <span class="comment">// 叫地主</span></span><br><span class="line">            Rob1,           <span class="comment">// 抢地主</span></span><br><span class="line">            Rob2,</span><br><span class="line">            Last1,          <span class="comment">// 只剩1张牌</span></span><br><span class="line">            Last2           <span class="comment">// 只剩2张牌</span></span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">AssistMusic</span>       <span class="comment">//辅助音乐</span></span><br><span class="line">    &#123;</span><br><span class="line">        Dispatch,   <span class="comment">// 发牌</span></span><br><span class="line">        SelectCard, <span class="comment">// 选牌</span></span><br><span class="line">        PlaneVoice, <span class="comment">// 飞机</span></span><br><span class="line">        BombVoice,  <span class="comment">// 炸弹</span></span><br><span class="line">        Alert,      <span class="comment">// 提醒</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">BGMControl</span><span class="params">(QObject *parent = <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化播放列表</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initPlayList</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.背景音乐(播放和停止播放)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">startBGM</span><span class="params">(<span class="type">int</span> volume)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stopBGM</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//2.播放玩家抢地址音乐</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">playerRobLordMusic</span><span class="params">(<span class="type">int</span> point, RoleSex sex, <span class="type">bool</span> isFirst)</span></span>;</span><br><span class="line">    <span class="comment">//3.播放出牌的背景音乐</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">playCardMusic</span><span class="params">(Cards cards, <span class="type">bool</span> isFirst, RoleSex sex)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">playLastMusic</span><span class="params">(CardType type, RoleSex sex)</span></span>;           <span class="comment">//播放剩余1张或2张牌的音乐</span></span><br><span class="line">    <span class="comment">//4.播放不出牌的背景音乐</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">playPassMusic</span><span class="params">(RoleSex sex)</span></span>;</span><br><span class="line">    <span class="comment">//5.播放辅助音乐</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">playAssistMusic</span><span class="params">(AssistMusic type)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stopAssistMusic</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//6.播放结尾音乐</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">playEndingMusic</span><span class="params">(<span class="type">bool</span> isWin)</span></span>;</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//0.man 1.woman 2.bgm 3.辅助音乐 4.结束音乐</span></span><br><span class="line">    QVector&lt;QMediaPlayer*&gt; m_players;</span><br><span class="line">    QVector&lt;QMediaPlaylist* &gt; m_lists;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="4-2-BGMControl函数实现"><a href="#4-2-BGMControl函数实现" class="headerlink" title="4.2 BGMControl函数实现"></a>4.2 BGMControl函数实现</h2><p>这部分就是实现了<code>BGMControl</code>类中定义的函数。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line">BGMControl::<span class="built_in">BGMControl</span>(QObject *parent) : <span class="built_in">QObject</span>(parent)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//0.man 1.woman 2.bgm 3.辅助音乐 4.结束音乐</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">5</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        QMediaPlayer* player = <span class="keyword">new</span> <span class="built_in">QMediaPlayer</span>(<span class="keyword">this</span>);             <span class="comment">//创建多媒体对象</span></span><br><span class="line">        QMediaPlaylist* list = <span class="keyword">new</span> <span class="built_in">QMediaPlaylist</span>(<span class="keyword">this</span>);           <span class="comment">//创建播放列表对象</span></span><br><span class="line">        <span class="keyword">if</span>(i&lt;<span class="number">2</span> || i == <span class="number">4</span>)                 <span class="comment">//当是0、1或4时，音乐只播放一次</span></span><br><span class="line">        &#123;</span><br><span class="line">            list-&gt;<span class="built_in">setPlaybackMode</span>(QMediaPlaylist::CurrentItemOnce);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(i == <span class="number">2</span>)                   <span class="comment">//当是2时，就循环播放音乐</span></span><br><span class="line">        &#123;</span><br><span class="line">            list-&gt;<span class="built_in">setPlaybackMode</span>(QMediaPlaylist::Loop);</span><br><span class="line">        &#125;</span><br><span class="line">        player-&gt;<span class="built_in">setPlaylist</span>(list);</span><br><span class="line">        player-&gt;<span class="built_in">setVolume</span>(<span class="number">100</span>);                <span class="comment">//音量</span></span><br><span class="line">        m_players.<span class="built_in">push_back</span>(player);</span><br><span class="line">        m_lists.<span class="built_in">push_back</span>(list);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">initPlayList</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化播放列表</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::initPlayList</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QStringList list;</span><br><span class="line">    list &lt;&lt; <span class="string">&quot;Man&quot;</span> &lt;&lt; <span class="string">&quot;Woman&quot;</span> &lt;&lt; <span class="string">&quot;BGM&quot;</span> &lt;&lt; <span class="string">&quot;Other&quot;</span> &lt;&lt; <span class="string">&quot;Ending&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读json配置文件</span></span><br><span class="line">    <span class="function">QFile <span class="title">file</span><span class="params">(<span class="string">&quot;:/conf/playList.json&quot;</span>)</span></span>;</span><br><span class="line">    file.<span class="built_in">open</span>(QFile::ReadOnly);</span><br><span class="line">    QByteArray json = file.<span class="built_in">readAll</span>();</span><br><span class="line">    file.<span class="built_in">close</span>();</span><br><span class="line">    <span class="comment">// 解析从文件中读出的json数据</span></span><br><span class="line">    QJsonDocument doc = QJsonDocument::<span class="built_in">fromJson</span>(json);</span><br><span class="line">    QJsonObject obj = doc.<span class="built_in">object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;list.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        QString prefix = list.<span class="built_in">at</span>(i);</span><br><span class="line">        QJsonArray array = obj.<span class="built_in">value</span>(prefix).<span class="built_in">toArray</span>();</span><br><span class="line">        <span class="comment">// 初始化多媒体播放列表</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>; j&lt;array.<span class="built_in">size</span>(); ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            m_lists[i]-&gt;<span class="built_in">addMedia</span>(<span class="built_in">QMediaContent</span>(<span class="built_in">QUrl</span>(array.<span class="built_in">at</span>(j).<span class="built_in">toString</span>())));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//游戏背景音乐</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::startBGM</span><span class="params">(<span class="type">int</span> volume)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//2是背景音乐，其音频对应的下标是2</span></span><br><span class="line">    m_lists[<span class="number">2</span>]-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">0</span>);</span><br><span class="line">    m_players[<span class="number">2</span>]-&gt;<span class="built_in">setVolume</span>(volume);</span><br><span class="line">    m_players[<span class="number">2</span>]-&gt;<span class="built_in">play</span>();                  <span class="comment">//通过对应的多媒体对象的play播放音乐</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::stopBGM</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_players[<span class="number">2</span>]-&gt;<span class="built_in">stop</span>();                  <span class="comment">//停止播放背景音乐</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 玩家下注了没有?</span></span><br><span class="line"><span class="comment">// 玩家的性别?</span></span><br><span class="line"><span class="comment">// 什么时候播放什么样的音频文件</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::playerRobLordMusic</span><span class="params">(<span class="type">int</span> point, RoleSex sex, <span class="type">bool</span> isFirst)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> index = sex == Man ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(isFirst &amp;&amp; point &gt; <span class="number">0</span>)                 <span class="comment">//如果是第一个叫地主，且下注分数大于0</span></span><br><span class="line">    &#123;</span><br><span class="line">        m_lists[index]-&gt;<span class="built_in">setCurrentIndex</span>(Order);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(point == <span class="number">0</span>)                      <span class="comment">//下注分数为0，即没有叫地主</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(isFirst)</span><br><span class="line">        &#123;</span><br><span class="line">            m_lists[index]-&gt;<span class="built_in">setCurrentIndex</span>(NoOrder);          <span class="comment">//如果是第一家就播放不叫音乐</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            m_lists[index]-&gt;<span class="built_in">setCurrentIndex</span>(NoRob);            <span class="comment">//如果不是第一家就播放不抢音乐</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(point == <span class="number">2</span>)                        <span class="comment">//下注2分</span></span><br><span class="line">    &#123;</span><br><span class="line">        m_lists[index]-&gt;<span class="built_in">setCurrentIndex</span>(Rob1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(point == <span class="number">3</span>)                        <span class="comment">//下注3分</span></span><br><span class="line">    &#123;</span><br><span class="line">        m_lists[index]-&gt;<span class="built_in">setCurrentIndex</span>(Rob2);</span><br><span class="line">    &#125;</span><br><span class="line">    m_players[index]-&gt;<span class="built_in">play</span>();             <span class="comment">//通过多媒体对象播放音乐</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//出牌的音乐</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::playCardMusic</span><span class="params">(Cards cards, <span class="type">bool</span> isFirst, RoleSex sex)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 得到播放列表</span></span><br><span class="line">    <span class="type">int</span> index = sex == Man ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    QMediaPlaylist* list = m_lists[index];           <span class="comment">//通过男生或女生，得到相应的播放列表对象</span></span><br><span class="line"></span><br><span class="line">    Card::CardPoint pt = Card::CardPoint::Card_Begin;</span><br><span class="line">    <span class="comment">// 取出牌型 然后进行判断</span></span><br><span class="line">    <span class="function">PlayHand <span class="title">hand</span><span class="params">(cards)</span></span>;</span><br><span class="line">    PlayHand::HandType type = hand.<span class="built_in">getHandType</span>();</span><br><span class="line">    <span class="keyword">if</span>(type == PlayHand::Hand_Single || type == PlayHand::Hand_Pair || type == PlayHand::Hand_Triple)</span><br><span class="line">    &#123;</span><br><span class="line">        pt = cards.<span class="built_in">takeRandomCard</span>().<span class="built_in">point</span>();    <span class="comment">//如果是单牌、双牌或三牌，取出其点数(取出随机一张牌即可)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> number = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span>(type)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="comment">// 单牌</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Single:</span><br><span class="line">        number = pt - <span class="number">1</span>;           <span class="comment">//因为pt的枚举类是从begin开始的，需要减1才能和json文件里面的枚举类一一对应</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 对牌</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Pair:</span><br><span class="line">        number = pt - <span class="number">1</span> + <span class="number">15</span>;      <span class="comment">//对牌在单牌后面，所以需要跳过单牌个数15</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 三张点数相同的牌</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Triple:</span><br><span class="line">        number = pt - <span class="number">1</span> + <span class="number">15</span> + <span class="number">13</span>;         <span class="comment">//跳过对牌个数13</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 三带一</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Triple_Single:</span><br><span class="line">        number = ThreeBindOne;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 三带二</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Triple_Pair:</span><br><span class="line">        number = ThreeBindPair;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 飞机</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Plane:</span><br><span class="line">    <span class="comment">// 飞机带两个单</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Plane_Two_Single:</span><br><span class="line">    <span class="comment">// 飞机带两个对儿</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Plane_Two_Pair:</span><br><span class="line">        number = Plane;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 连对</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Seq_Pair:</span><br><span class="line">        number = SequencePair;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 顺子</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Seq_Single:</span><br><span class="line">        number = Sequence;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 炸弹</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Bomb:</span><br><span class="line">        number = Bomb;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 王炸</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Bomb_Jokers:</span><br><span class="line">        number = JokerBomb;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">// 炸弹带一对儿</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Bomb_Pair:</span><br><span class="line">    <span class="comment">// 炸弹带两单</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Bomb_Two_Single:</span><br><span class="line">    <span class="comment">// 王炸带一对儿</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Bomb_Jokers_Pair:</span><br><span class="line">    <span class="comment">// 王炸带两单</span></span><br><span class="line">    <span class="keyword">case</span> PlayHand::Hand_Bomb_Jokers_Two_Single:</span><br><span class="line">        number = FourBindTwo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!isFirst &amp;&amp; (number &gt;= Plane &amp;&amp; number &lt;= FourBindTwo))</span><br><span class="line">    &#123;</span><br><span class="line">        list-&gt;<span class="built_in">setCurrentIndex</span>(MoreBiger1 + QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        list-&gt;<span class="built_in">setCurrentIndex</span>(number);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 播放音乐</span></span><br><span class="line">    m_players[index]-&gt;<span class="built_in">play</span>();</span><br><span class="line">    <span class="keyword">if</span>(number == Bomb || number == JokerBomb)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">playAssistMusic</span>(BombVoice);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(number == Plane)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">playAssistMusic</span>(PlaneVoice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::playLastMusic</span><span class="params">(CardType type, RoleSex sex)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 玩家的性别</span></span><br><span class="line">    <span class="type">int</span> index = sex == Man ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 2. 找到播放列表</span></span><br><span class="line">    QMediaPlaylist* list = m_lists[index];</span><br><span class="line">    <span class="keyword">if</span>(m_players[index]-&gt;<span class="built_in">state</span>() == QMediaPlayer::StoppedState)     <span class="comment">//如果当前对应的多媒体播放是空闲状态</span></span><br><span class="line">    &#123;</span><br><span class="line">        list-&gt;<span class="built_in">setCurrentIndex</span>(type);</span><br><span class="line">        m_players[index]-&gt;<span class="built_in">play</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        QTimer::<span class="built_in">singleShot</span>(<span class="number">1500</span>, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">            list-&gt;<span class="built_in">setCurrentIndex</span>(type);</span><br><span class="line">            m_players[index]-&gt;<span class="built_in">play</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::playPassMusic</span><span class="params">(RoleSex sex)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1. 玩家的性别</span></span><br><span class="line">    <span class="type">int</span> index = sex == Man ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// 2. 找到播放列表</span></span><br><span class="line">    QMediaPlaylist* list = m_lists[index];</span><br><span class="line">    <span class="comment">// 3. 找到要播放的音乐</span></span><br><span class="line">    <span class="type">int</span> random = QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(<span class="number">4</span>);    <span class="comment">//随机生成一个数字，0到3</span></span><br><span class="line">    list-&gt;<span class="built_in">setCurrentIndex</span>(Pass1 + random);                  <span class="comment">//随机播放不要音乐</span></span><br><span class="line">    <span class="comment">// 4. 播放音乐</span></span><br><span class="line">    m_players[index]-&gt;<span class="built_in">play</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::playAssistMusic</span><span class="params">(AssistMusic type)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QMediaPlaylist::PlaybackMode mode;                <span class="comment">//定义一个播放模式</span></span><br><span class="line">    <span class="keyword">if</span>(type == Dispatch)                              <span class="comment">//如果是发牌状态，就循环播放音乐</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 循环播放</span></span><br><span class="line">        mode = QMediaPlaylist::CurrentItemInLoop;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>                                       <span class="comment">//其它情况，只播放一次</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 单曲播放一次</span></span><br><span class="line">        mode = QMediaPlaylist::CurrentItemOnce;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 找到播放列表</span></span><br><span class="line">    QMediaPlaylist* list = m_lists[<span class="number">3</span>];</span><br><span class="line">    <span class="comment">// 3. 找到要播放的音乐</span></span><br><span class="line">    list-&gt;<span class="built_in">setCurrentIndex</span>(type);</span><br><span class="line">    list-&gt;<span class="built_in">setPlaybackMode</span>(mode);</span><br><span class="line">    <span class="comment">// 4. 播放音乐</span></span><br><span class="line">    m_players[<span class="number">3</span>]-&gt;<span class="built_in">play</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::stopAssistMusic</span><span class="params">()</span>           <span class="comment">//停止辅助音乐播放</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_players[<span class="number">3</span>]-&gt;<span class="built_in">stop</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//最后输或赢播放音乐</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BGMControl::playEndingMusic</span><span class="params">(<span class="type">bool</span> isWin)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(isWin)</span><br><span class="line">    &#123;</span><br><span class="line">        m_lists[<span class="number">4</span>]-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        m_lists[<span class="number">4</span>]-&gt;<span class="built_in">setCurrentIndex</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    m_players[<span class="number">4</span>]-&gt;<span class="built_in">play</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="5-游戏主窗口类GamePanel"><a href="#5-游戏主窗口类GamePanel" class="headerlink" title="5. 游戏主窗口类GamePanel"></a>5. 游戏主窗口类GamePanel</h1><p>游戏主窗口类是游戏的展示界面，玩家玩游戏的整个过程都是在这个窗口中显示的。</p>
<h2 id="5-1-GamePanel类头文件"><a href="#5-1-GamePanel类头文件" class="headerlink" title="5.1 GamePanel类头文件"></a>5.1 GamePanel类头文件</h2><p>游戏窗口类的头文件需要定义很多初始化的函数，同时也需要接收很多发送过来的信号，然后通过相应的函数(槽函数)来实现对应的操作。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GamePanel</span> : <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">GamePanel</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">GamePanel</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">AnimationType</span>&#123;ShunZi, LianDui, Plane, JokerBomb, Bomb, Bet&#125;;             <span class="comment">//效果动画类要显示的一些动画</span></span><br><span class="line">    <span class="comment">//初始化游戏控制类信息</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">gameControlInit</span><span class="params">()</span></span>;       <span class="comment">//该函数也负责信号槽的一些连接</span></span><br><span class="line">    <span class="comment">//更新分数面板的分数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">updatePlayerScore</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//切割并存储图片</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initCardMap</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//裁剪图片</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cropImage</span><span class="params">(QPixmap&amp; pix, <span class="type">int</span> x, <span class="type">int</span> y, Card&amp; c)</span></span>;       <span class="comment">//参数：裁剪图片对象，x位置，y位置，卡牌对象(需要它的花色和点数)</span></span><br><span class="line">    <span class="comment">//初始化游戏按钮组</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initButtonsGroup</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//初始化玩家在窗口中的上下文环境(每个玩家的位置信息)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initPlayerContext</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//初始化游戏场景</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initGameScene</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//处理游戏的状态</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">gameStatusPrecess</span><span class="params">(GameControl::GameStatus status)</span></span>;     <span class="comment">//参数枚举类型游戏状态，有发牌、叫地主和出牌</span></span><br><span class="line">    <span class="comment">//发牌</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">startDispatchCard</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//移动扑克牌</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">cardMoveStep</span><span class="params">(Player* player, <span class="type">int</span> curPos)</span></span>;</span><br><span class="line">    <span class="comment">//处理分发得到的扑克牌(发牌时卡牌区域更新)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">disposeCard</span><span class="params">(Player* player, <span class="type">const</span> Cards&amp; cards)</span></span>;        <span class="comment">//参数：处理的牌属于哪个玩家，要处理的牌(一张或多张)</span></span><br><span class="line">    <span class="comment">//更新扑克牌在窗口中的显示(把玩家得到的牌更新到该显示的位置上,和打出的牌更新到出牌区域)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">updatePlayerCards</span><span class="params">(Player* player)</span></span>;          <span class="comment">//更新的是哪个玩家的扑克牌窗口</span></span><br><span class="line">    <span class="comment">//加载玩家的头像</span></span><br><span class="line">    <span class="function">QPixmap <span class="title">loadRoleImage</span><span class="params">(Player::Sex sex, Player::Direction direct, Player::Role role)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定时器的处理动作</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onDispatchCard</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//处理玩家状态的变化(槽函数)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onPlayerStatusChanged</span><span class="params">(Player* player, GameControl::PlayerStatus status)</span></span>;</span><br><span class="line">    <span class="comment">//处理玩家抢地主情况，再在主窗口显示(槽函数)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onGrabLordBet</span><span class="params">(Player* player, <span class="type">int</span> bet, <span class="type">bool</span> flag)</span></span>;     <span class="comment">//参数：具体哪个玩家，下注分数，是否是第一个叫地主的玩家</span></span><br><span class="line">    <span class="comment">//处理玩家的出牌显示</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onDisposePlayHand</span><span class="params">(Player* player, Cards&amp; cards)</span></span>;</span><br><span class="line">    <span class="comment">//处理用户玩家鼠标选牌(槽函数)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onCardSelected</span><span class="params">(Qt::MouseButton button)</span></span>;</span><br><span class="line">    <span class="comment">//处理用户玩家出牌(槽函数)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onUserPlayHand</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//处理用户放弃出牌(槽函数)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">onUserPass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示特效动画</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showAnimation</span><span class="params">(AnimationType type, <span class="type">int</span> bet=<span class="number">0</span>)</span></span>;  <span class="comment">//因为室友特效动画都是该函数显示，所以直接传入动画枚举类，当是抢地主分数的时候，会用到参2</span></span><br><span class="line">    <span class="comment">//隐藏玩家打出的牌</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">hidePlayerDropCards</span><span class="params">(Player* player)</span></span>;</span><br><span class="line">    <span class="comment">// 显示玩家的最终得分(结束面板设置)</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showEndingScorePanel</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//初始化闹钟倒计时</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">initCountDown</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// 重写父类的虚函数---事件处理函数</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">paintEvent</span><span class="params">(QPaintEvent* ev)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">mouseMoveEvent</span><span class="params">(QMouseEvent* ev)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">enum</span> <span class="title class_">CardAlign</span>&#123;Horizontal, Vertical&#125;;             <span class="comment">//对齐方式</span></span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">PlayerContext</span>&#123;                   <span class="comment">//每个玩家有一个这样的结构体,是存放玩家对应的位置信息</span></span><br><span class="line">        <span class="comment">//1.玩家扑克牌显示的区域</span></span><br><span class="line">        QRect cardRect;</span><br><span class="line">        <span class="comment">//2.出牌的区域</span></span><br><span class="line">        QRect playHandRect;</span><br><span class="line">        <span class="comment">//3.扑克牌的对齐方式(水平 or 垂直)</span></span><br><span class="line">        CardAlign align;</span><br><span class="line">        <span class="comment">//4.扑克牌显示正面还是背面</span></span><br><span class="line">        <span class="type">bool</span> isFrontSide;</span><br><span class="line">        <span class="comment">//5.游戏过程中的提示信息，比如：不出</span></span><br><span class="line">        QLabel* info;</span><br><span class="line">        <span class="comment">//6.玩家的头像</span></span><br><span class="line">        QLabel* roleImg;</span><br><span class="line">        <span class="comment">//7.玩家刚打出的牌</span></span><br><span class="line">        Cards lastCards;</span><br><span class="line">    &#125;;</span><br><span class="line">    Ui::GamePanel *ui;</span><br><span class="line">    QPixmap m_bkImage;                     <span class="comment">//背景图片的加载对象</span></span><br><span class="line">    GameControl* m_gameCtl;                <span class="comment">//游戏控制类对象</span></span><br><span class="line">    QVector&lt;Player*&gt; m_playerList;         <span class="comment">//存放三个玩家对象的实例</span></span><br><span class="line">    QMap&lt;Card, CardPanel*&gt;m_cardMap;       <span class="comment">//保存卡牌数据和卡牌窗口对象的容器</span></span><br><span class="line">    QSize m_cardSize;                      <span class="comment">//卡牌大小(宽和高)</span></span><br><span class="line">    QPixmap m_cardBackImg;                 <span class="comment">//卡牌背景图加载对象</span></span><br><span class="line">    QMap&lt;Player*, PlayerContext&gt; m_contextMap;      <span class="comment">//将玩家与其对应的位置结构体存到map</span></span><br><span class="line"></span><br><span class="line">    CardPanel* m_baseCard;              <span class="comment">//刚开始，发牌区的扑克牌</span></span><br><span class="line">    CardPanel* m_moveCard;              <span class="comment">//移动中的扑克牌</span></span><br><span class="line">    QVector&lt;CardPanel*&gt;m_last3Card;     <span class="comment">//最后三张底牌</span></span><br><span class="line"></span><br><span class="line">    QPoint m_baseCardPos;               <span class="comment">//起始时，牌的初始位置(中心偏上一点)</span></span><br><span class="line">    GameControl::GameStatus m_gameStatus;           <span class="comment">//存放游戏状态</span></span><br><span class="line">    QTimer* m_timer;                    <span class="comment">//定时器</span></span><br><span class="line"></span><br><span class="line">    AnimationWindow* m_animation;            <span class="comment">//动画效果类对象</span></span><br><span class="line"></span><br><span class="line">    CardPanel* m_curSelCard;       <span class="comment">//鼠标选择的卡牌窗口对象(只限自己手牌的，因为点击其它机器人玩家的牌，在onCardSelected()函数中已经被排除了)</span></span><br><span class="line">    QSet&lt;CardPanel*&gt; m_selectCards;       <span class="comment">//保存用户鼠标选择的卡牌窗口对象</span></span><br><span class="line">    <span class="comment">//下面两个在updatePlayerCards()里面初始化的</span></span><br><span class="line">    QRect m_cardsRect;                          <span class="comment">//存储用户玩家剩余的牌显示区域</span></span><br><span class="line">    QHash&lt;CardPanel*,QRect&gt; m_userCards;         <span class="comment">//记录用户玩家手中的牌，以及每张牌在窗口中的位置</span></span><br><span class="line"></span><br><span class="line">    CountDown* m_countDown;                <span class="comment">//闹钟类对象指针</span></span><br><span class="line"></span><br><span class="line">    BGMControl* m_bgm;                     <span class="comment">//BGM音乐类对象</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-GamePanel类函数实现"><a href="#5-2-GamePanel类函数实现" class="headerlink" title="5.2 GamePanel类函数实现"></a>5.2 GamePanel类函数实现</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br></pre></td><td class="code"><pre><span class="line">GamePanel::<span class="built_in">GamePanel</span>(QWidget *parent)</span><br><span class="line">    : <span class="built_in">QMainWindow</span>(parent)</span><br><span class="line">    , <span class="built_in">ui</span>(<span class="keyword">new</span> Ui::GamePanel)</span><br><span class="line">&#123;</span><br><span class="line">    ui-&gt;<span class="built_in">setupUi</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 背景图</span></span><br><span class="line">    <span class="type">int</span> num = QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(<span class="number">10</span>);          <span class="comment">//生成0到9随机数</span></span><br><span class="line">    QString path = <span class="built_in">QString</span>(<span class="string">&quot;:/images/background-%1.png&quot;</span>).<span class="built_in">arg</span>(num+<span class="number">1</span>);     <span class="comment">//拼接背景图路径</span></span><br><span class="line">    m_bkImage.<span class="built_in">load</span>(path);   <span class="comment">//随机加载一张背景图(刚开始时)，通过事件处理器函数painEvent就能将背景图画到窗口上了，当窗口初始化好后，painEvent会自动调用</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.窗口的标题和大小(固定)</span></span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setWindowTitle</span>(<span class="string">&quot;欢乐斗地主&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>-&gt;<span class="built_in">setFixedSize</span>(<span class="number">1000</span>, <span class="number">650</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 实例化游戏控制类对象</span></span><br><span class="line">    <span class="built_in">gameControlInit</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 玩家得分(更新)</span></span><br><span class="line">    <span class="built_in">updatePlayerScore</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. 切割游戏图片</span></span><br><span class="line">    <span class="built_in">initCardMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. 初始化游戏中的按钮组</span></span><br><span class="line">    <span class="built_in">initButtonsGroup</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. 初始化玩家在窗口中的上下文环境</span></span><br><span class="line">    <span class="built_in">initPlayerContext</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8. 扑克牌场景初始化</span></span><br><span class="line">    <span class="built_in">initGameScene</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9. 倒计时窗口初始化</span></span><br><span class="line">    <span class="built_in">initCountDown</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定时器实例化</span></span><br><span class="line">    m_timer = <span class="keyword">new</span> <span class="built_in">QTimer</span>(<span class="keyword">this</span>);</span><br><span class="line">    <span class="built_in">connect</span>(m_timer, &amp;QTimer::timeout, <span class="keyword">this</span>, &amp;GamePanel::onDispatchCard);     <span class="comment">//每触发一次定时器，就会调用槽函数，发牌</span></span><br><span class="line"></span><br><span class="line">    m_animation = <span class="keyword">new</span> <span class="built_in">AnimationWindow</span>(<span class="keyword">this</span>);          <span class="comment">//创建一个动画效果类，指定了父对象，它就显示在父对象窗口上面，而且没有边框</span></span><br><span class="line">    m_bgm = <span class="keyword">new</span> <span class="built_in">BGMControl</span>(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GamePanel::~<span class="built_in">GamePanel</span>()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">delete</span> ui;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::gameControlInit</span><span class="params">()</span>       <span class="comment">//实例化游戏控制类对象</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_gameCtl = <span class="keyword">new</span> <span class="built_in">GameControl</span>(<span class="keyword">this</span>);       <span class="comment">//指定父对象，窗口析构的时候，就会先自动析构m_gameCtl了</span></span><br><span class="line">    m_gameCtl-&gt;<span class="built_in">playerInit</span>();                 <span class="comment">//三个玩家对象被创建出来了</span></span><br><span class="line">    <span class="comment">//得到三个玩家的实例对象</span></span><br><span class="line">    Robot* leftRobot = m_gameCtl-&gt;<span class="built_in">getLeftRobot</span>();</span><br><span class="line">    Robot* rightRobot = m_gameCtl-&gt;<span class="built_in">getRightRobot</span>();</span><br><span class="line">    UserPlayer* user = m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>();</span><br><span class="line">    m_playerList &lt;&lt; leftRobot &lt;&lt; rightRobot &lt;&lt; user;        <span class="comment">//存储顺序：左侧机器人，右侧机器人，用户玩家</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//GameControl类发出的一个信号(玩家状态变化)，主窗口接收并处理相应的槽函数</span></span><br><span class="line">    <span class="built_in">connect</span>(m_gameCtl, &amp;GameControl::playerStatusChanged, <span class="keyword">this</span>, &amp;GamePanel::onPlayerStatusChanged);</span><br><span class="line">    <span class="comment">//GameControl类发出的一个信号(抢地主的情况)，主窗口接收并处理相应的槽函数</span></span><br><span class="line">    <span class="built_in">connect</span>(m_gameCtl, &amp;GameControl::notifyGrabLordBet, <span class="keyword">this</span>, &amp;GamePanel::onGrabLordBet);</span><br><span class="line">    <span class="comment">//GameControl类发出的一个信号(游戏状态变化),主窗口接收并处理相应的槽函数</span></span><br><span class="line">    <span class="built_in">connect</span>(m_gameCtl, &amp;GameControl::gameStatusChanged, <span class="keyword">this</span>, &amp;GamePanel::gameStatusPrecess);</span><br><span class="line">    <span class="comment">//GameControl类发出的一个信号(玩家出牌了),主窗口接收并处理相应的槽函数(处理一些动画效果，更新玩家的牌，并将出的牌显示在出牌区域)</span></span><br><span class="line">    <span class="built_in">connect</span>(m_gameCtl, &amp;GameControl::notifyPlayHand, <span class="keyword">this</span>, &amp;GamePanel::onDisposePlayHand);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//不管是哪个玩家得到牌后都会发出一个信号，主窗口接收该信号</span></span><br><span class="line">    <span class="built_in">connect</span>(leftRobot, &amp;Player::notifyPickCards, <span class="keyword">this</span>, &amp;GamePanel::disposeCard);</span><br><span class="line">    <span class="built_in">connect</span>(rightRobot, &amp;Player::notifyPickCards, <span class="keyword">this</span>, &amp;GamePanel::disposeCard);</span><br><span class="line">    <span class="built_in">connect</span>(user, &amp;Player::notifyPickCards, <span class="keyword">this</span>, &amp;GamePanel::disposeCard);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::updatePlayerScore</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;scorePanel-&gt;<span class="built_in">setScores</span>(                    <span class="comment">//setScores函数负责将传入的得分显示在窗口上</span></span><br><span class="line">                m_playerList[<span class="number">0</span>]-&gt;<span class="built_in">getScore</span>(),</span><br><span class="line">                m_playerList[<span class="number">1</span>]-&gt;<span class="built_in">getScore</span>(),</span><br><span class="line">                m_playerList[<span class="number">2</span>]-&gt;<span class="built_in">getScore</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::initCardMap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.加载大图</span></span><br><span class="line">    <span class="function">QPixmap <span class="title">pixmap</span><span class="params">(<span class="string">&quot;:/images/card.png&quot;</span>)</span></span>;</span><br><span class="line">    <span class="comment">//2.计算每张图片的大小</span></span><br><span class="line">    m_cardSize.<span class="built_in">setWidth</span>(pixmap.<span class="built_in">width</span>()/<span class="number">13</span>);</span><br><span class="line">    m_cardSize.<span class="built_in">setHeight</span>(pixmap.<span class="built_in">height</span>()/<span class="number">5</span>);</span><br><span class="line">    <span class="comment">//3.背面图加载(裁剪)，需要提供背景图左上角的点，copy(x轴，y轴，要裁剪的宽度，要裁剪的高度)</span></span><br><span class="line">    m_cardBackImg = pixmap.<span class="built_in">copy</span>(<span class="number">2</span>*m_cardSize.<span class="built_in">width</span>(), <span class="number">4</span>*m_cardSize.<span class="built_in">height</span>(), m_cardSize.<span class="built_in">width</span>(), m_cardSize.<span class="built_in">height</span>());</span><br><span class="line">    <span class="comment">//正常花色</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>, suit=Card::Suit_Begin+<span class="number">1</span>; suit&lt;Card::Suit_End; suit++,i++)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>,pt=Card::Card_Begin+<span class="number">1</span>; pt&lt;Card::Card_SJ; pt++,j++)&#123;</span><br><span class="line">            <span class="function">Card <span class="title">card</span><span class="params">((Card::CardPoint)pt, (Card::CardSuit)suit)</span></span>;</span><br><span class="line">            <span class="comment">//裁剪图片(参数：大图对象，裁剪卡牌的x轴，裁剪卡牌的y轴，对应的单张卡牌对象(记录的是对应的花色和点数))</span></span><br><span class="line">            <span class="built_in">cropImage</span>(pixmap, j*m_cardSize.<span class="built_in">width</span>(), i*m_cardSize.<span class="built_in">height</span>(), card);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//小王</span></span><br><span class="line">    Card c;</span><br><span class="line">    c.<span class="built_in">setPoint</span>(Card::Card_SJ);</span><br><span class="line">    c.<span class="built_in">setSuit</span>(Card::Suit_Begin);</span><br><span class="line">    <span class="built_in">cropImage</span>(pixmap, <span class="number">0</span>, <span class="number">4</span>*m_cardSize.<span class="built_in">height</span>(), c);</span><br><span class="line">    <span class="comment">//大王</span></span><br><span class="line">    c.<span class="built_in">setPoint</span>(Card::Card_BJ);</span><br><span class="line">    c.<span class="built_in">setSuit</span>(Card::Suit_Begin);</span><br><span class="line">    <span class="built_in">cropImage</span>(pixmap, m_cardSize.<span class="built_in">width</span>(), <span class="number">4</span>*m_cardSize.<span class="built_in">height</span>(), c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::cropImage</span><span class="params">(QPixmap &amp;pix, <span class="type">int</span> x, <span class="type">int</span> y, Card&amp; c)</span>              <span class="comment">//裁剪图片</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    QPixmap sub = pix.<span class="built_in">copy</span>(x, y, m_cardSize.<span class="built_in">width</span>(), m_cardSize.<span class="built_in">height</span>());       <span class="comment">//得到一张扑克牌正面</span></span><br><span class="line">    CardPanel* panel = <span class="keyword">new</span> <span class="built_in">CardPanel</span>(<span class="keyword">this</span>);           <span class="comment">//创建一张卡牌窗口对象</span></span><br><span class="line">    panel-&gt;<span class="built_in">setImage</span>(sub, m_cardBackImg);              <span class="comment">//参数：正面图片对象，背面图片对象 -----&gt;图片显示的已经是对应的花色和点数了</span></span><br><span class="line">    panel-&gt;<span class="built_in">setCard</span>(c);                                <span class="comment">//设置花色和点数   -----&gt;这相当于是记录该图片的花色和点数</span></span><br><span class="line">    panel-&gt;<span class="built_in">hide</span>();                                    <span class="comment">//隐藏</span></span><br><span class="line">    m_cardMap.<span class="built_in">insert</span>(c,panel);                        <span class="comment">//裁剪成功的卡牌存入容器，方便后期管理和处理</span></span><br><span class="line">    <span class="comment">//接收CardPanel类发出的鼠标选择信号---&gt;每张牌的窗口对象只要满足条件，都可以发出信号</span></span><br><span class="line">    <span class="built_in">connect</span>(panel, &amp;CardPanel::cardSelected, <span class="keyword">this</span>, &amp;GamePanel::onCardSelected);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::initButtonsGroup</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ui-&gt;btnGroup-&gt;<span class="built_in">initButtons</span>();                                <span class="comment">//所有的按钮初始化完成</span></span><br><span class="line">    ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::Start);              <span class="comment">//开始时，显示的是开始游戏页面</span></span><br><span class="line">    <span class="comment">//处理各个按钮发出的信号</span></span><br><span class="line">    <span class="comment">//初始页面的开始按钮，当发出startGame信号，就说明开始游戏的按钮被按下了</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;btnGroup, &amp;ButtonGroup::startGame, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        <span class="comment">//界面的初始化</span></span><br><span class="line">        ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::Empty);        <span class="comment">//选择空页面，这样窗口的所有按钮都被隐藏了</span></span><br><span class="line">        m_gameCtl-&gt;<span class="built_in">clearPlayerScore</span>();          <span class="comment">//将所有玩家的得分清0(在构造函数时调用过了，可写可不写)</span></span><br><span class="line">        <span class="built_in">updatePlayerScore</span>();                    <span class="comment">//更新所有玩家的得分(在构造函数时调用过了，可写可不写)</span></span><br><span class="line">        <span class="comment">//修改游戏状态 ---&gt; 发牌</span></span><br><span class="line">        <span class="built_in">gameStatusPrecess</span>(GameControl::DispatchCard);        <span class="comment">//基于这个参数，里面是通过switcha函数来执行不同游戏状态下的函数</span></span><br><span class="line">        <span class="comment">//播放背景音乐</span></span><br><span class="line">        m_bgm-&gt;<span class="built_in">startBGM</span>(<span class="number">80</span>);                 <span class="comment">//指定音量为80</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;btnGroup, &amp;ButtonGroup::playHand, <span class="keyword">this</span>, &amp;GamePanel::onUserPlayHand); <span class="comment">//当点击了出牌按钮，会发出playHand信号</span></span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;btnGroup, &amp;ButtonGroup::pass, <span class="keyword">this</span>, &amp;GamePanel::onUserPass);</span><br><span class="line">    <span class="built_in">connect</span>(ui-&gt;btnGroup, &amp;ButtonGroup::betPoint, <span class="keyword">this</span>, [=](<span class="type">int</span> bet)&#123;        <span class="comment">//叫地主几分按钮</span></span><br><span class="line">        m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>()-&gt;<span class="built_in">grabLordBet</span>(bet);</span><br><span class="line">        ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::Empty);        <span class="comment">//按完下注分数按钮后，就执行选择空页面，这样窗口的所有按钮都被隐藏了</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::initPlayerContext</span><span class="params">()</span>              <span class="comment">//为每个玩家设置对应的位置信息</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1.设置玩家扑克牌的区域</span></span><br><span class="line">    <span class="type">const</span> QRect cardsRect[]=&#123;</span><br><span class="line">        <span class="comment">//x,y,width,heught</span></span><br><span class="line">        <span class="built_in">QRect</span>(<span class="number">90</span>,<span class="number">130</span>,<span class="number">100</span>,<span class="built_in">height</span>()<span class="number">-200</span>),                           <span class="comment">//左侧机器人</span></span><br><span class="line">        <span class="built_in">QRect</span>(<span class="built_in">rect</span>().<span class="built_in">right</span>()<span class="number">-190</span>, <span class="number">130</span>, <span class="number">100</span>, <span class="built_in">height</span>()<span class="number">-200</span>),        <span class="comment">//右侧机器人</span></span><br><span class="line">        <span class="built_in">QRect</span>(<span class="number">250</span>, <span class="built_in">rect</span>().<span class="built_in">bottom</span>()<span class="number">-120</span>, <span class="built_in">width</span>()<span class="number">-500</span>,<span class="number">100</span>)          <span class="comment">//当前玩家</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//2.玩家出牌的区域</span></span><br><span class="line">    <span class="type">const</span> QRect playHandRect[]=&#123;</span><br><span class="line">        <span class="built_in">QRect</span>(<span class="number">260</span>,<span class="number">150</span>,<span class="number">100</span>,<span class="number">100</span>),                           <span class="comment">//左侧机器人</span></span><br><span class="line">        <span class="built_in">QRect</span>(<span class="built_in">rect</span>().<span class="built_in">right</span>()<span class="number">-360</span>, <span class="number">150</span>, <span class="number">100</span>, <span class="number">100</span>),        <span class="comment">//右侧机器人</span></span><br><span class="line">        <span class="built_in">QRect</span>(<span class="number">150</span>, <span class="built_in">rect</span>().<span class="built_in">bottom</span>()<span class="number">-290</span>, <span class="built_in">width</span>()<span class="number">-300</span>,<span class="number">105</span>)          <span class="comment">//当前玩家</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//3.玩家头像显示的位置</span></span><br><span class="line">    <span class="type">const</span> QPoint roleImgPos[]=&#123;</span><br><span class="line">        <span class="built_in">QPoint</span>(cardsRect[<span class="number">0</span>].<span class="built_in">left</span>()<span class="number">-80</span>,cardsRect[<span class="number">0</span>].<span class="built_in">height</span>()/<span class="number">2</span>+<span class="number">20</span>),         <span class="comment">//左侧机器人</span></span><br><span class="line">        <span class="built_in">QPoint</span>(cardsRect[<span class="number">1</span>].<span class="built_in">right</span>()+<span class="number">10</span>,cardsRect[<span class="number">1</span>].<span class="built_in">height</span>()/<span class="number">2</span>+<span class="number">20</span>),        <span class="comment">//右侧机器人</span></span><br><span class="line">        <span class="built_in">QPoint</span>(cardsRect[<span class="number">2</span>].<span class="built_in">right</span>()<span class="number">-10</span>,cardsRect[<span class="number">2</span>].<span class="built_in">top</span>()<span class="number">-10</span>)              <span class="comment">//当前玩家</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//循环</span></span><br><span class="line">    <span class="type">int</span> index = m_playerList.<span class="built_in">indexOf</span>(m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>());     <span class="comment">//得到m_playerList存放用户玩家的下标索引(是2,但是不想把代码写死，所以通过这行代码获取)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;m_playerList.<span class="built_in">size</span>();i++)&#123;                          <span class="comment">//变量三个玩家</span></span><br><span class="line">        PlayerContext context;                                <span class="comment">//为每个玩家创建各自的PlayerContext位置结构体</span></span><br><span class="line">        context.align = i==index ? Horizontal:Vertical;             <span class="comment">//对齐方式：机器人玩家和用户玩家是不一样的</span></span><br><span class="line">        context.isFrontSide = i==index ? <span class="literal">true</span>:<span class="literal">false</span>;                  <span class="comment">//扑克牌展示正面还是背面，需要判定，i=index，说明是用户玩家</span></span><br><span class="line">        context.cardRect = cardsRect[i];                              <span class="comment">//卡牌区域(因为m_playerList和cardsRect的顺序是一样的，所以直接赋值即可)</span></span><br><span class="line">        context.playHandRect = playHandRect[i];                       <span class="comment">//出牌区域</span></span><br><span class="line">        <span class="comment">//提示信息(每个玩家的提示信息位置)</span></span><br><span class="line">        context.info = <span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="keyword">this</span>);                <span class="comment">//创建一个标签</span></span><br><span class="line">        context.info-&gt;<span class="built_in">resize</span>(<span class="number">160</span>, <span class="number">98</span>);                  <span class="comment">//指定标签大小</span></span><br><span class="line">        context.info-&gt;<span class="built_in">hide</span>();                           <span class="comment">//初始是隐藏的</span></span><br><span class="line">        <span class="comment">//将提示信息显示到出牌区域的中心位置</span></span><br><span class="line">        QRect rect = playHandRect[i];                   <span class="comment">//每个玩家的出牌区域</span></span><br><span class="line">        <span class="function">QPoint <span class="title">pt</span><span class="params">(rect.left()+(rect.width()-context.info-&gt;width())/<span class="number">2</span>, rect.top()+(rect.height()-context.info-&gt;height())/<span class="number">2</span>)</span></span>;   <span class="comment">//获取出牌区域的中心位置，需要(出牌区域框架-提示信息框架)/2</span></span><br><span class="line">        context.info-&gt;<span class="built_in">move</span>(pt);          <span class="comment">//将提示信息移动到pt位置</span></span><br><span class="line">        <span class="comment">//玩家头像</span></span><br><span class="line">        context.roleImg = <span class="keyword">new</span> <span class="built_in">QLabel</span>(<span class="keyword">this</span>);         <span class="comment">//创建一个放头像的标签</span></span><br><span class="line">        context.roleImg-&gt;<span class="built_in">resize</span>(<span class="number">84</span>, <span class="number">120</span>);           <span class="comment">//固定大小</span></span><br><span class="line">        context.roleImg-&gt;<span class="built_in">hide</span>();                    <span class="comment">//隐藏</span></span><br><span class="line">        context.roleImg-&gt;<span class="built_in">move</span>(roleImgPos[i]);       <span class="comment">//将头像标签移动到指定位置</span></span><br><span class="line">        m_contextMap.<span class="built_in">insert</span>(m_playerList.<span class="built_in">at</span>(i), context);   <span class="comment">//key存玩家对象，value存对应的位置结构体context</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::initGameScene</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//下面三部分，每一部分都对应一张或多张扑克牌，每张扑克牌都是一个卡牌窗口，所以需要创建卡牌窗口对象</span></span><br><span class="line">    <span class="comment">//1.发牌区的扑克牌</span></span><br><span class="line">    m_baseCard = <span class="keyword">new</span> <span class="built_in">CardPanel</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_baseCard-&gt;<span class="built_in">setImage</span>(m_cardBackImg, m_cardBackImg);      <span class="comment">//两面都显示背面即可</span></span><br><span class="line">    <span class="comment">// 2. 发牌过程中移动的扑克牌</span></span><br><span class="line">    m_moveCard = <span class="keyword">new</span> <span class="built_in">CardPanel</span>(<span class="keyword">this</span>);</span><br><span class="line">    m_moveCard-&gt;<span class="built_in">setImage</span>(m_cardBackImg, m_cardBackImg);      <span class="comment">//两面都显示背面即可</span></span><br><span class="line">    <span class="comment">// 3. 最后的三张底牌(用于窗口的显示)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        CardPanel* panel = <span class="keyword">new</span> <span class="built_in">CardPanel</span>(<span class="keyword">this</span>);</span><br><span class="line">        panel-&gt;<span class="built_in">setImage</span>(m_cardBackImg, m_cardBackImg);      <span class="comment">//两面都显示背面即可</span></span><br><span class="line">        m_last3Card.<span class="built_in">push_back</span>(panel);</span><br><span class="line">        panel-&gt;<span class="built_in">hide</span>();              <span class="comment">//初始先隐藏</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//发牌区和移动过程扑克牌的位置(同一个)</span></span><br><span class="line">    m_baseCardPos = <span class="built_in">QPoint</span>((<span class="built_in">width</span>() - m_cardSize.<span class="built_in">width</span>()) / <span class="number">2</span>, <span class="built_in">height</span>() / <span class="number">2</span> - <span class="number">100</span>);     <span class="comment">//中心位置偏上一点</span></span><br><span class="line">    m_baseCard-&gt;<span class="built_in">move</span>(m_baseCardPos);         <span class="comment">//设置发牌区的扑克牌位置</span></span><br><span class="line">    m_moveCard-&gt;<span class="built_in">move</span>(m_baseCardPos);          <span class="comment">//设置移动过程中扑克牌的位置</span></span><br><span class="line">    <span class="comment">//底牌位置(三种牌的x轴不一样，y轴一样)</span></span><br><span class="line">    <span class="type">int</span> base = (<span class="built_in">width</span>() - <span class="number">3</span> * m_cardSize.<span class="built_in">width</span>() - <span class="number">2</span> * <span class="number">10</span>) / <span class="number">2</span>;   <span class="comment">//width()是当前窗口的总宽度，三张牌有2个空隙(2*10)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        m_last3Card[i]-&gt;<span class="built_in">move</span>(base + (m_cardSize.<span class="built_in">width</span>() + <span class="number">10</span>) * i, <span class="number">20</span>);      <span class="comment">//分别设置三张底牌的位置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::gameStatusPrecess</span><span class="params">(GameControl::GameStatus status)</span>            <span class="comment">//处理游戏的状态</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//记录游戏状态</span></span><br><span class="line">    m_gameStatus = status;</span><br><span class="line">    <span class="comment">//处理游戏状态</span></span><br><span class="line">    <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">    <span class="keyword">case</span> GameControl::DispatchCard:        <span class="comment">//开始发牌状态</span></span><br><span class="line">        <span class="built_in">startDispatchCard</span>();               <span class="comment">//调用发牌函数</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GameControl::CallingLord:         <span class="comment">//叫地主状态</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//取出底牌数据</span></span><br><span class="line">        CardList last3Card = m_gameCtl-&gt;<span class="built_in">getSurplusCards</span>().<span class="built_in">toCardList</span>();     <span class="comment">//将存放三张底牌的set容器转为了QVector容器</span></span><br><span class="line">        <span class="comment">//给底牌窗口设置图片</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;last3Card.<span class="built_in">size</span>(); i++)&#123;        <span class="comment">//遍历三张底牌</span></span><br><span class="line">            QPixmap front = m_cardMap[last3Card.<span class="built_in">at</span>(i)]-&gt;<span class="built_in">getImage</span>();         <span class="comment">//获取每张牌它的一个图像</span></span><br><span class="line">            m_last3Card[i]-&gt;<span class="built_in">setImage</span>(front,m_cardBackImg);            <span class="comment">//设置该卡牌的正面图片和反面图片</span></span><br><span class="line">            m_last3Card[i]-&gt;<span class="built_in">hide</span>();                                   <span class="comment">//先是隐藏的</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//开始叫地主</span></span><br><span class="line">        m_gameCtl-&gt;<span class="built_in">startLordCard</span>();      <span class="comment">//gamecontrol的一个函数，里面会发出一个信号，主窗口再接收处理槽函数onPlayerStatusChanged</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> GameControl::PlayingHand:           <span class="comment">//出牌状态(抢完地主)</span></span><br><span class="line">        <span class="comment">//隐藏发牌区的底牌和移动的牌</span></span><br><span class="line">        m_baseCard-&gt;<span class="built_in">hide</span>();</span><br><span class="line">        m_moveCard-&gt;<span class="built_in">hide</span>();</span><br><span class="line">        <span class="comment">//显示留给地主的三张底牌(顶部)</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;m_last3Card.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            m_last3Card.<span class="built_in">at</span>(i)-&gt;<span class="built_in">show</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;m_playerList.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">            PlayerContext &amp;context = m_contextMap[m_playerList.<span class="built_in">at</span>(i)];       <span class="comment">//获取每个玩家的位置结构体</span></span><br><span class="line">            context.info-&gt;<span class="built_in">hide</span>();                       <span class="comment">//隐藏各个玩家抢地主过程中的提示信息</span></span><br><span class="line">            <span class="comment">//显示各个玩家的头像</span></span><br><span class="line">            Player* player = m_playerList.<span class="built_in">at</span>(i);</span><br><span class="line">            QPixmap pixmap = <span class="built_in">loadRoleImage</span>(player-&gt;<span class="built_in">getSex</span>(),player-&gt;<span class="built_in">getDirection</span>(), player-&gt;<span class="built_in">getRole</span>());   <span class="comment">//得到对应玩家的头像</span></span><br><span class="line">            context.roleImg-&gt;<span class="built_in">setPixmap</span>(pixmap);     <span class="comment">//设置头像</span></span><br><span class="line">            context.roleImg-&gt;<span class="built_in">show</span>();                <span class="comment">//显示出来</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::startDispatchCard</span><span class="params">()</span>            <span class="comment">//发牌</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//重置每张卡牌的属性(不是所有属性)   QMap&lt;Card, CardPanel*&gt;m_cardMap;</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it=m_cardMap.<span class="built_in">begin</span>(); it!=m_cardMap.<span class="built_in">end</span>(); it++)&#123;</span><br><span class="line">        it.<span class="built_in">value</span>()-&gt;<span class="built_in">setSeclected</span>(<span class="literal">false</span>);     <span class="comment">//设置非选中状态</span></span><br><span class="line">        it.<span class="built_in">value</span>()-&gt;<span class="built_in">setFrontSide</span>(<span class="literal">true</span>);     <span class="comment">//显示正面图片</span></span><br><span class="line">        it.<span class="built_in">value</span>()-&gt;<span class="built_in">hide</span>();                  <span class="comment">//窗口隐藏</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//隐藏三张底牌</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;m_last3Card.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">        m_last3Card.<span class="built_in">at</span>(i)-&gt;<span class="built_in">hide</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//重置玩家的窗口上下文信息(位置)</span></span><br><span class="line">    <span class="type">int</span> index = m_playerList.<span class="built_in">indexOf</span>(m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>());        <span class="comment">//传入用户玩家对象，得到它在m_playerList的下标</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;m_playerList.<span class="built_in">size</span>(); i++)&#123;                            <span class="comment">//对玩家容器进行遍历</span></span><br><span class="line">        m_contextMap[m_playerList.<span class="built_in">at</span>(i)].lastCards.<span class="built_in">clear</span>();              <span class="comment">//玩家上一次打出的牌进行清空</span></span><br><span class="line">        m_contextMap[m_playerList.<span class="built_in">at</span>(i)].info-&gt;<span class="built_in">hide</span>();                   <span class="comment">//隐藏游戏过程中的提示信息</span></span><br><span class="line">        m_contextMap[m_playerList.<span class="built_in">at</span>(i)].roleImg-&gt;<span class="built_in">hide</span>();                <span class="comment">//玩家的头像隐藏</span></span><br><span class="line">        m_contextMap[m_playerList.<span class="built_in">at</span>(i)].isFrontSide = i==index ? <span class="literal">true</span> : <span class="literal">false</span>;   <span class="comment">//显示正面还是背面(用户玩家显示正面，机器人玩家显示背面)</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//重置所有玩家的卡牌数据</span></span><br><span class="line">    m_gameCtl-&gt;<span class="built_in">resetCardData</span>();        <span class="comment">//该函数里面是做了：洗牌、清空三个玩家的手牌、将出牌玩家对象指向空和出的牌清空</span></span><br><span class="line">    <span class="comment">//显示底牌</span></span><br><span class="line">    m_baseCard-&gt;<span class="built_in">show</span>();            <span class="comment">//正中间的扑克牌，刚开是背面时(显示出来)</span></span><br><span class="line">    <span class="comment">//隐藏按钮面板</span></span><br><span class="line">    ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::Empty);        <span class="comment">//传入的是空窗口</span></span><br><span class="line">    <span class="comment">//启动定时器</span></span><br><span class="line">    m_timer-&gt;<span class="built_in">start</span>(<span class="number">10</span>);               <span class="comment">//每隔10毫秒，定时器就触发一次</span></span><br><span class="line">    <span class="comment">//播放背景音乐</span></span><br><span class="line">    m_bgm-&gt;<span class="built_in">playAssistMusic</span>(BGMControl::Dispatch);             <span class="comment">//播放发牌的音乐</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::cardMoveStep</span><span class="params">(Player *player, <span class="type">int</span> curPos)</span>     <span class="comment">//参数：具体是哪个玩家，移动步长的次数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//得到每个玩家的扑克牌展示区域</span></span><br><span class="line">    QRect cardRect = m_contextMap[player].cardRect;</span><br><span class="line">    <span class="comment">//每个玩家的单位步长</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> unit[] = &#123;(m_baseCardPos.<span class="built_in">x</span>() - cardRect.<span class="built_in">right</span>())/<span class="number">100</span>, (cardRect.<span class="built_in">left</span>() - m_baseCardPos.<span class="built_in">x</span>())/<span class="number">100</span>, (cardRect.<span class="built_in">top</span>() - m_baseCardPos.<span class="built_in">y</span>())/<span class="number">100</span> &#125;;   <span class="comment">//左侧玩家:(发牌区域x坐标-左侧玩家区域右变x轴)/长度；右侧玩家</span></span><br><span class="line">    <span class="comment">//每次窗口移动的时候，每个玩家对应的移动牌的实时坐标位置</span></span><br><span class="line">    <span class="type">const</span> QPoint pos[]=&#123; <span class="built_in">QPoint</span>(m_baseCardPos.<span class="built_in">x</span>() - curPos * unit[<span class="number">0</span>], m_baseCardPos.<span class="built_in">y</span>()), <span class="built_in">QPoint</span>(m_baseCardPos.<span class="built_in">x</span>() + curPos * unit[<span class="number">1</span>], m_baseCardPos.<span class="built_in">y</span>()), <span class="built_in">QPoint</span>(m_baseCardPos.<span class="built_in">x</span>(), m_baseCardPos.<span class="built_in">y</span>() + curPos * unit[<span class="number">2</span>])&#125;;  <span class="comment">//左侧机器人x轴坐标越来越小；右侧机器人x轴坐标越来越大</span></span><br><span class="line">    <span class="comment">//移动扑克牌窗口</span></span><br><span class="line">    <span class="type">int</span> index = m_playerList.<span class="built_in">indexOf</span>(player);          <span class="comment">//得到对应玩家的下标</span></span><br><span class="line">    m_moveCard-&gt;<span class="built_in">move</span>(pos[index]);                      <span class="comment">//卡牌移动到对应玩家 移动路径上 的某一点</span></span><br><span class="line">    <span class="comment">//临界状态处理</span></span><br><span class="line">    <span class="keyword">if</span>(curPos == <span class="number">0</span>)&#123;</span><br><span class="line">        m_moveCard-&gt;<span class="built_in">show</span>();      <span class="comment">//说明该牌才刚开始移动，想要展示</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(curPos == <span class="number">100</span>)&#123;</span><br><span class="line">        m_moveCard-&gt;<span class="built_in">hide</span>();      <span class="comment">//说明该牌已经到了对应玩家的卡牌区域，就需要隐藏了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//得到一张或多张卡牌时，会发出一个信号告诉主窗口，该函数就是接收该信号的槽函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::disposeCard</span><span class="params">(Player *player, <span class="type">const</span> Cards &amp;cards)</span>      <span class="comment">//卡牌区域更新</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Cards&amp; myCard = <span class="built_in">const_cast</span>&lt;Cards&amp;&gt;(cards);</span><br><span class="line">    CardList list = myCard.<span class="built_in">toCardList</span>();</span><br><span class="line">    <span class="comment">//CardList list = cards.toCardList();           //CardList是QVector&lt;Card&gt;的一个别名</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;list.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">        CardPanel* panel = m_cardMap[list.<span class="built_in">at</span>(i)];       <span class="comment">//通过Card取出对应的窗口对象</span></span><br><span class="line">        panel-&gt;<span class="built_in">setOwner</span>(player);                        <span class="comment">//设置该张卡牌窗口的所有者</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//更新扑克牌在窗口中的显示</span></span><br><span class="line">    <span class="built_in">updatePlayerCards</span>(player);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::updatePlayerCards</span><span class="params">(Player *player)</span>       <span class="comment">//把玩家得到的牌更新到该显示的位置上</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Cards cards = player-&gt;<span class="built_in">getCards</span>();             <span class="comment">//取出该玩家得到的牌(手牌)</span></span><br><span class="line">    CardList list = cards.<span class="built_in">toCardList</span>();           <span class="comment">//将得到的牌存放到QVector，默认是降序排列</span></span><br><span class="line"></span><br><span class="line">    m_cardsRect = <span class="built_in">QRect</span>();             <span class="comment">//先将m_cardsRect初始化</span></span><br><span class="line">    m_userCards.<span class="built_in">clear</span>();               <span class="comment">//每次进来要清空，因为手牌位置发生变化了</span></span><br><span class="line">    <span class="comment">//取出展示扑克牌的区域</span></span><br><span class="line">    <span class="type">int</span> cardSpace = <span class="number">20</span>;               <span class="comment">//卡牌间相隔的像素(也是每张牌能显示出来的宽度)</span></span><br><span class="line">    QRect cardsRect = m_contextMap[player].cardRect;       <span class="comment">//取出该玩家的手牌区域坐标</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;list.<span class="built_in">size</span>(); i++)&#123;                   <span class="comment">//遍历每一张手牌</span></span><br><span class="line">        CardPanel* panel = m_cardMap[list.<span class="built_in">at</span>(i)];       <span class="comment">//每一张牌对应一张卡牌窗口</span></span><br><span class="line">        panel-&gt;<span class="built_in">show</span>();                       <span class="comment">//显示窗口</span></span><br><span class="line">        panel-&gt;<span class="built_in">raise</span>();                      <span class="comment">//让当前的卡牌窗口升起来(就是让当前卡牌窗口是所有之前出现的卡牌子窗口中最上层那个)</span></span><br><span class="line">        panel-&gt;<span class="built_in">setFrontSide</span>(m_contextMap[player].isFrontSide);    <span class="comment">//玩家的卡牌(手牌)显示正面还是反面</span></span><br><span class="line">        <span class="comment">//水平 or 垂直显示 -----&gt;下面是为了让卡牌显示在卡牌区域的正中间(卡牌区域要大一点)</span></span><br><span class="line">        <span class="keyword">if</span>(m_contextMap[player].align == Horizontal)&#123;          <span class="comment">//如果是水平(用户玩家)</span></span><br><span class="line">            <span class="comment">//(总宽度-牌占用的宽度)/2：卡牌区域左边距离+(卡牌区域总宽度 - (卡牌总数量-1)*间隔 - 最后一张牌的完整宽度)/2</span></span><br><span class="line">            <span class="type">int</span> leftX = cardsRect.<span class="built_in">left</span>()+(cardsRect.<span class="built_in">width</span>()-(list.<span class="built_in">size</span>()<span class="number">-1</span>)*cardSpace - panel-&gt;<span class="built_in">width</span>())/<span class="number">2</span>;</span><br><span class="line">            <span class="type">int</span> topY = cardsRect.<span class="built_in">top</span>() + (cardsRect.<span class="built_in">height</span>() - m_cardSize.<span class="built_in">height</span>())/<span class="number">2</span>;  <span class="comment">//卡牌区域上面距离+(卡牌区域高度-卡牌高度)/2</span></span><br><span class="line">            <span class="keyword">if</span>(panel-&gt;<span class="built_in">isSelected</span>())&#123;       <span class="comment">//如果这张扑克牌是被选中了，有各向上的弹跳效果</span></span><br><span class="line">                topY -= <span class="number">10</span>;                <span class="comment">//y轴像素-10</span></span><br><span class="line">            &#125;</span><br><span class="line">            panel-&gt;<span class="built_in">move</span>(leftX + cardSpace*i, topY);     <span class="comment">//移动卡牌窗口坐标位置</span></span><br><span class="line">            m_cardsRect = <span class="built_in">QRect</span>(leftX, topY, cardSpace*i+m_cardSize.<span class="built_in">width</span>(),m_cardSize.<span class="built_in">height</span>());</span><br><span class="line">            <span class="type">int</span> curWidth = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(list.<span class="built_in">size</span>()<span class="number">-1</span> == i)&#123;                 <span class="comment">//如果是最后一张牌了，则该牌的宽度是一整张</span></span><br><span class="line">                curWidth = m_cardSize.<span class="built_in">width</span>();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                curWidth = cardSpace;               <span class="comment">//如果不是最后一张牌，则宽度就是间隙</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function">QRect <span class="title">cardRect</span><span class="params">(leftX + cardSpace*i, topY, curWidth, m_cardSize.height())</span></span>;</span><br><span class="line">            m_userCards.<span class="built_in">insert</span>(panel, cardRect);      <span class="comment">//将每张牌对象和在窗口的位置</span></span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;                     <span class="comment">//如果是垂直(机器人玩家)</span></span><br><span class="line">            <span class="comment">//因为不是在窗口的最左测，所以还是需要加上cardsRect.left()</span></span><br><span class="line">            <span class="type">int</span> leftX = cardsRect.<span class="built_in">left</span>() + (cardsRect.<span class="built_in">width</span>() - m_cardSize.<span class="built_in">width</span>())/<span class="number">2</span>;  <span class="comment">//卡牌区域左边距离+(卡牌区域宽度-卡牌宽度)/2</span></span><br><span class="line">            <span class="type">int</span> topY = cardsRect.<span class="built_in">top</span>() + (cardsRect.<span class="built_in">height</span>() - (list.<span class="built_in">size</span>()<span class="number">-1</span>)*cardSpace - panel-&gt;<span class="built_in">height</span>())/<span class="number">2</span>;  <span class="comment">//m_cardSize和panel都可以表示牌的高度</span></span><br><span class="line">            panel-&gt;<span class="built_in">move</span>(leftX, topY+i*cardSpace);         <span class="comment">//移动卡牌窗口坐标位置</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//显示玩家打出的牌</span></span><br><span class="line">    <span class="comment">//得到当前玩家的出牌区域以及本轮打出的牌</span></span><br><span class="line">    QRect playCardRect = m_contextMap[player].playHandRect;</span><br><span class="line">    Cards lastCards = m_contextMap[player].lastCards;                <span class="comment">//玩家本轮打出的牌</span></span><br><span class="line">    <span class="keyword">if</span>(!lastCards.<span class="built_in">isEmpty</span>())&#123;                                        <span class="comment">//如果不为空(本轮出牌了)</span></span><br><span class="line">        <span class="type">int</span> playSpacing = <span class="number">24</span>;                      <span class="comment">//出牌区域中牌与牌的间隙</span></span><br><span class="line">        CardList lastCardList = lastCards.<span class="built_in">toCardList</span>();              <span class="comment">//将出的牌存到QVector容器</span></span><br><span class="line">        CardList::ConstIterator itplayed = lastCardList.<span class="built_in">constBegin</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; itplayed!=lastCardList.<span class="built_in">constEnd</span>(); itplayed++,i++)&#123;             <span class="comment">//通过常量迭代器遍历本轮出的牌</span></span><br><span class="line">            CardPanel* panel = m_cardMap[*itplayed];          <span class="comment">//得到对应的卡牌窗口对象</span></span><br><span class="line">            panel-&gt;<span class="built_in">setFrontSide</span>(<span class="literal">true</span>);                        <span class="comment">//显示正面</span></span><br><span class="line">            panel-&gt;<span class="built_in">raise</span>();           <span class="comment">//提升牌(让当前窗口能显示在同以级别窗口的上方)---&gt;当有多张考牌时，为了达到堆叠的效果，2叠1，3叠2，4叠3</span></span><br><span class="line">            <span class="comment">//将打出的牌移动到出牌区域</span></span><br><span class="line">            <span class="keyword">if</span>(m_contextMap[player].align == Horizontal)&#123;            <span class="comment">//水平</span></span><br><span class="line">                <span class="type">int</span> leftBase = playCardRect.<span class="built_in">left</span>()+(playCardRect.<span class="built_in">width</span>()-(lastCardList.<span class="built_in">size</span>()<span class="number">-1</span>)*playSpacing-panel-&gt;<span class="built_in">width</span>())/<span class="number">2</span>;</span><br><span class="line">                <span class="type">int</span> top = playCardRect.<span class="built_in">top</span>() + (playCardRect.<span class="built_in">height</span>()-panel-&gt;<span class="built_in">width</span>())/<span class="number">2</span>;</span><br><span class="line">                panel-&gt;<span class="built_in">move</span>(leftBase+i*playSpacing, top);      <span class="comment">//牌与牌之间有空隙</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">int</span> left = playCardRect.<span class="built_in">left</span>()+(playCardRect.<span class="built_in">width</span>()-panel-&gt;<span class="built_in">width</span>())/<span class="number">2</span>;   <span class="comment">//出牌区域左像素+卡牌x在出牌区域x的中点像素</span></span><br><span class="line">                <span class="type">int</span> top = playCardRect.<span class="built_in">top</span>();               <span class="comment">//y轴就是出牌区域的y轴</span></span><br><span class="line">                panel-&gt;<span class="built_in">move</span>(left, top+i*playSpacing);           <span class="comment">//牌与牌之间有空隙</span></span><br><span class="line">            &#125;</span><br><span class="line">            panel-&gt;<span class="built_in">show</span>();                 <span class="comment">//不确定是隐藏还是显示的，预防是隐藏的，所以就将其显示出来</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">QPixmap <span class="title">GamePanel::loadRoleImage</span><span class="params">(Player::Sex sex, Player::Direction direct, Player::Role role)</span>  <span class="comment">//参2是图像的显示方位</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//找图片</span></span><br><span class="line">    QVector&lt;QString&gt;lordMan;</span><br><span class="line">    QVector&lt;QString&gt;lordWoman;</span><br><span class="line">    QVector&lt;QString&gt;farmerMan;</span><br><span class="line">    QVector&lt;QString&gt;farmerWoman;</span><br><span class="line">    lordMan &lt;&lt; <span class="string">&quot;:/images/lord_man_1.png&quot;</span> &lt;&lt; <span class="string">&quot;:/images/lord_man_2.png&quot;</span>;</span><br><span class="line">    lordWoman &lt;&lt; <span class="string">&quot;:/images/lord_woman_1.png&quot;</span> &lt;&lt; <span class="string">&quot;:/images/lord_woman_2.png&quot;</span>;</span><br><span class="line">    farmerMan &lt;&lt; <span class="string">&quot;:/images/farmer_man_1.png&quot;</span> &lt;&lt; <span class="string">&quot;:/images/farmer_man_2.png&quot;</span>;</span><br><span class="line">    farmerWoman &lt;&lt; <span class="string">&quot;:/images/farmer_woman_1.png&quot;</span> &lt;&lt; <span class="string">&quot;:/images/farmer_woman_2.png&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过QImage加载图片,因为其提供镜像操作(将朝向左的图片变为朝向右的图片)</span></span><br><span class="line">    QImage image;</span><br><span class="line">    <span class="type">int</span> random = QRandomGenerator::<span class="built_in">global</span>()-&gt;<span class="built_in">bounded</span>(<span class="number">2</span>);          <span class="comment">//随机用一张图片</span></span><br><span class="line">    <span class="keyword">if</span>(sex==Player::Man &amp;&amp; role==Player::Lord)&#123;                   <span class="comment">//如果是男性，且是地主</span></span><br><span class="line">        image.<span class="built_in">load</span>(lordMan.<span class="built_in">at</span>(random));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sex==Player::Man &amp;&amp; role==Player::Farmer)&#123;           <span class="comment">//如果是男性，且是农民</span></span><br><span class="line">        image.<span class="built_in">load</span>(farmerMan.<span class="built_in">at</span>(random));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sex==Player::Woman &amp;&amp; role==Player::Lord)&#123;           <span class="comment">//如果是女性，且是地主</span></span><br><span class="line">        image.<span class="built_in">load</span>(lordWoman.<span class="built_in">at</span>(random));</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(sex==Player::Woman &amp;&amp; role==Player::Farmer)&#123;         <span class="comment">//如果是女性，且是农民</span></span><br><span class="line">        image.<span class="built_in">load</span>(farmerWoman.<span class="built_in">at</span>(random));</span><br><span class="line">    &#125;</span><br><span class="line">    QPixmap pixmap;</span><br><span class="line">    <span class="keyword">if</span>(direct == Player::Left)&#123;        <span class="comment">//如果图片是显示在左侧的，就不需要做镜像</span></span><br><span class="line">        pixmap = QPixmap::<span class="built_in">fromImage</span>(image);        <span class="comment">//因为返回值是QPixmap，所以还得进行转换</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        pixmap = QPixmap::<span class="built_in">fromImage</span>(image.<span class="built_in">mirrored</span>(<span class="literal">true</span>,<span class="literal">false</span>));   <span class="comment">//参1：是否做水平镜像；参2：是否做垂直镜像</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pixmap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::onDispatchCard</span><span class="params">()</span>                 <span class="comment">//每触发一次定时器就会执行该函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//记录扑克牌的位置(各玩家的牌移动距离都分100次步长完成)</span></span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> curMovePos = <span class="number">0</span>;     <span class="comment">//主要是记录移动了多少个步长(第一次进该函数执行一次后，以后进该函数，都不执行该句)</span></span><br><span class="line">    <span class="comment">//获取当前玩家</span></span><br><span class="line">    Player* curPlayer = m_gameCtl-&gt;<span class="built_in">getCurrentPlayer</span>();</span><br><span class="line">    <span class="keyword">if</span>(curMovePos &gt;= <span class="number">100</span>)&#123;               <span class="comment">//满足条件的话，就说明当前玩家得到了牌，轮到下一个玩家得牌了</span></span><br><span class="line">        <span class="comment">//给当前玩家发一张牌</span></span><br><span class="line">        Card card = m_gameCtl-&gt;<span class="built_in">takeOneCard</span>();            <span class="comment">//随机获取一张牌</span></span><br><span class="line">        curPlayer-&gt;<span class="built_in">storeDispatchCard</span>(card);              <span class="comment">//将该牌存入到当前玩家的手牌中</span></span><br><span class="line">        <span class="comment">//Cards cs(card);                   //带参构造函数</span></span><br><span class="line">        <span class="comment">//disposeCard(curPlayer,cs);   //卡牌区域更新，该函数在上面执行storeDispatchCard()时，里面就发出了信号，并执行disposeCard</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//切换当前玩家</span></span><br><span class="line">        m_gameCtl-&gt;<span class="built_in">setCurrentPlayer</span>(curPlayer-&gt;<span class="built_in">getNextPlayer</span>());      <span class="comment">//将下一个玩家改为当前玩家，轮到发牌给他了</span></span><br><span class="line">        curMovePos = <span class="number">0</span>;           <span class="comment">//重新将步长次数置为0</span></span><br><span class="line">        <span class="comment">//发牌动画</span></span><br><span class="line">        <span class="built_in">cardMoveStep</span>(curPlayer, curMovePos);</span><br><span class="line">        <span class="comment">//判断牌是否发完了</span></span><br><span class="line">        <span class="keyword">if</span>(m_gameCtl-&gt;<span class="built_in">getSurplusCards</span>().<span class="built_in">cardCount</span>()==<span class="number">3</span>)&#123;</span><br><span class="line">            <span class="comment">//终止定时器</span></span><br><span class="line">            m_timer-&gt;<span class="built_in">stop</span>();</span><br><span class="line">            <span class="comment">//切换游戏状态</span></span><br><span class="line">            <span class="built_in">gameStatusPrecess</span>(GameControl::CallingLord);        <span class="comment">//切换为叫地主状态</span></span><br><span class="line">            <span class="comment">//终止发牌音乐的播放(牌发完了)</span></span><br><span class="line">            m_bgm-&gt;<span class="built_in">stopAssistMusic</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//移动扑克牌</span></span><br><span class="line">    <span class="built_in">cardMoveStep</span>(curPlayer, curMovePos);        <span class="comment">//参数：当前玩家，移动步长的次数</span></span><br><span class="line">    curMovePos += <span class="number">15</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理玩家状态的变化(槽函数)---&gt;gamecontrol类发出的信号(玩家状态变化)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::onPlayerStatusChanged</span><span class="params">(Player *player, GameControl::PlayerStatus status)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(status)&#123;</span><br><span class="line">    <span class="keyword">case</span> GameControl::ThinkingForCallLord:                        <span class="comment">//考虑叫地主</span></span><br><span class="line">        <span class="keyword">if</span>(player == m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>())&#123;                 <span class="comment">//只有当前玩家是用户玩家时，才执行下面(机器人玩家没有该按钮组窗口)</span></span><br><span class="line">            ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::CallLord, m_gameCtl-&gt;<span class="built_in">getPlayerMaxBet</span>()); <span class="comment">//切换按钮组窗口为抢地主的窗口(修改目前下注最高分)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GameControl::ThinkingForPlayHand:                        <span class="comment">//考虑出牌</span></span><br><span class="line">        <span class="comment">//玩家出牌前，隐藏上一轮打出的牌</span></span><br><span class="line">        <span class="built_in">hidePlayerDropCards</span>(player);</span><br><span class="line">        <span class="keyword">if</span>(player == m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>())&#123;                       <span class="comment">//先判断玩家是否是用户玩家</span></span><br><span class="line">            <span class="comment">//取出出牌玩家的对象</span></span><br><span class="line">            Player* pendPlayer = m_gameCtl-&gt;<span class="built_in">getPendPlayer</span>();            <span class="comment">//取出上一次的出牌玩家，如果为空，说明出牌刚开始,</span></span><br><span class="line">            <span class="keyword">if</span>(pendPlayer == m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>() || pendPlayer == <span class="literal">nullptr</span>)&#123;              <span class="comment">//如果用户玩家是上一次的出牌玩家(说明上一次出的牌，机器人玩家不要)</span></span><br><span class="line">                ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::PlayCard);           <span class="comment">//显示相应的按钮组窗口(这是用户玩家自由出牌)</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;                                                       <span class="comment">//不是上一次的出牌玩家(轮到自己了，可以出牌，也可以不出牌)</span></span><br><span class="line">                ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::PassOrPlay);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;                                                        <span class="comment">//如果玩家是机器人玩家，则就不用显示空即可</span></span><br><span class="line">            ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::Empty);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> GameControl::Winning:</span><br><span class="line">        m_bgm-&gt;<span class="built_in">stopBGM</span>();                    <span class="comment">//结束播放背景音乐</span></span><br><span class="line">        <span class="comment">//如果玩家赢了，就要显示出其它玩家的牌(由背面变为正面)</span></span><br><span class="line">        m_contextMap[m_gameCtl-&gt;<span class="built_in">getLeftRobot</span>()].isFrontSide = <span class="literal">true</span>;        <span class="comment">//先将遍历置为true</span></span><br><span class="line">        m_contextMap[m_gameCtl-&gt;<span class="built_in">getRightRobot</span>()].isFrontSide = <span class="literal">true</span>;</span><br><span class="line">        <span class="built_in">updatePlayerCards</span>(m_gameCtl-&gt;<span class="built_in">getLeftRobot</span>());            <span class="comment">//updatePlayerCards会将剩余的牌会显示正面</span></span><br><span class="line">        <span class="built_in">updatePlayerCards</span>(m_gameCtl-&gt;<span class="built_in">getRightRobot</span>());</span><br><span class="line">        <span class="comment">//更新玩家的得分</span></span><br><span class="line">        <span class="built_in">updatePlayerScore</span>();</span><br><span class="line">        m_gameCtl-&gt;<span class="built_in">setCurrentPlayer</span>(player);            <span class="comment">//将本局赢的玩家又设为当前玩家(下一局由它先决定要不要地主)</span></span><br><span class="line">        <span class="built_in">showEndingScorePanel</span>();                         <span class="comment">//显示游戏结束面板</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::onGrabLordBet</span><span class="params">(Player *player, <span class="type">int</span> bet, <span class="type">bool</span> flag)</span>   <span class="comment">//处理抢地主情况的槽函数(显示在主窗口)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//显示抢地主的信息提示</span></span><br><span class="line">    PlayerContext context = m_contextMap[player];</span><br><span class="line">    <span class="keyword">if</span>(bet == <span class="number">0</span>)&#123;                      <span class="comment">//分数为0，说明不叫地主</span></span><br><span class="line">        context.info-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/buqinag.png&quot;</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;         <span class="comment">//如果是第一次叫地主</span></span><br><span class="line">            context.info-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/jiaodizhu.png&quot;</span>));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            context.info-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/qiangdizhu.png&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//显示叫地主的分数(如果不叫地主，下注分数是0，就没有必要显示，所以这句代码写在else语句里)</span></span><br><span class="line">        <span class="built_in">showAnimation</span>(Bet,bet);            <span class="comment">//调用动画效果类。参1是动画效果枚举类的分数枚举，参2是具体的分数</span></span><br><span class="line">    &#125;</span><br><span class="line">    context.info-&gt;<span class="built_in">show</span>();              <span class="comment">//显示出提示信息</span></span><br><span class="line">    <span class="comment">//播放分数的背景音乐</span></span><br><span class="line">    m_bgm-&gt;<span class="built_in">playerRobLordMusic</span>(bet, (BGMControl::RoleSex)player-&gt;<span class="built_in">getSex</span>(),flag);        <span class="comment">//性别需要强制转换</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::onDisposePlayHand</span><span class="params">(Player *player, Cards &amp;cards)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//存储玩家当轮打出的牌</span></span><br><span class="line">    <span class="keyword">auto</span> it = m_contextMap.<span class="built_in">find</span>(player);         <span class="comment">//获取出牌玩家的一些位置信息</span></span><br><span class="line">    it-&gt;lastCards = cards;</span><br><span class="line">    <span class="comment">//2.根据牌型播放游戏特效</span></span><br><span class="line">    <span class="function">PlayHand <span class="title">hand</span><span class="params">(cards)</span></span>;</span><br><span class="line">    PlayHand::HandType type = hand.<span class="built_in">getHandType</span>();        <span class="comment">//获得牌的类型</span></span><br><span class="line">    <span class="keyword">if</span>(type == PlayHand::Hand_Plane || type==PlayHand::Hand_Plane_Two_Pair || type== PlayHand::Hand_Plane_Two_Single)&#123;</span><br><span class="line">        <span class="built_in">showAnimation</span>(Plane);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type == PlayHand::Hand_Seq_Pair)&#123;</span><br><span class="line">        <span class="built_in">showAnimation</span>(LianDui);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type == PlayHand::Hand_Seq_Single)&#123;</span><br><span class="line">        <span class="built_in">showAnimation</span>(ShunZi);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type == PlayHand::Hand_Bomb)&#123;</span><br><span class="line">        <span class="built_in">showAnimation</span>(Bomb);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type == PlayHand::Hand_Bomb_Jokers)&#123;</span><br><span class="line">        <span class="built_in">showAnimation</span>(JokerBomb);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果玩家打出的是空牌(不出牌)，显示提示信息</span></span><br><span class="line">    <span class="keyword">if</span>(cards.<span class="built_in">isEmpty</span>())&#123;</span><br><span class="line">        it-&gt;info-&gt;<span class="built_in">setPixmap</span>(<span class="built_in">QPixmap</span>(<span class="string">&quot;:/images/pass.png&quot;</span>));</span><br><span class="line">        it-&gt;info-&gt;<span class="built_in">show</span>();         <span class="comment">//把info对应的窗口显示出来(之前被隐藏掉了)</span></span><br><span class="line">        m_bgm-&gt;<span class="built_in">playPassMusic</span>((BGMControl::RoleSex)player-&gt;<span class="built_in">getRole</span>());      <span class="comment">//播放不要音乐</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;            <span class="comment">//如果不为空，就需要判断是不是第一个(自由)出牌的玩家</span></span><br><span class="line">        <span class="keyword">if</span>(m_gameCtl-&gt;<span class="built_in">getPendPlayer</span>()==player || m_gameCtl-&gt;<span class="built_in">getPendPlayer</span>()==<span class="literal">nullptr</span>)&#123;    <span class="comment">//如果是自由出牌</span></span><br><span class="line">            m_bgm-&gt;<span class="built_in">playCardMusic</span>(cards, <span class="literal">true</span>, (BGMControl::RoleSex)player-&gt;<span class="built_in">getSex</span>());     <span class="comment">//播放音乐，是自由出牌，参2为true</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            m_bgm-&gt;<span class="built_in">playCardMusic</span>(cards, <span class="literal">false</span>, (BGMControl::RoleSex)player-&gt;<span class="built_in">getSex</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3.更新玩家剩余的牌</span></span><br><span class="line">    <span class="built_in">updatePlayerCards</span>(player);</span><br><span class="line">    <span class="comment">//4. 播放提示音乐</span></span><br><span class="line">    <span class="comment">//判断玩家剩余的牌的数量</span></span><br><span class="line">    <span class="keyword">if</span>(player-&gt;<span class="built_in">getCards</span>().<span class="built_in">cardCount</span>() == <span class="number">2</span>)&#123;              <span class="comment">//剩余2张</span></span><br><span class="line">        m_bgm-&gt;<span class="built_in">playLastMusic</span>(BGMControl::Last2, (BGMControl::RoleSex)player-&gt;<span class="built_in">getSex</span>());</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(player-&gt;<span class="built_in">getCards</span>().<span class="built_in">cardCount</span>() == <span class="number">1</span>)&#123;        <span class="comment">//剩余1张</span></span><br><span class="line">        m_bgm-&gt;<span class="built_in">playLastMusic</span>(BGMControl::Last1, (BGMControl::RoleSex)player-&gt;<span class="built_in">getSex</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//该函数是一个槽函数，是接收到control发出的键盘选择信号后，执行的槽函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::onCardSelected</span><span class="params">(Qt::MouseButton button)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//1. 判断是不是出牌状态</span></span><br><span class="line">    <span class="keyword">if</span>(m_gameStatus==GameControl::DispatchCard || m_gameStatus==GameControl::CallingLord)&#123;  <span class="comment">//如果当前是发牌或叫地主状态，直接返回</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2. 判断发出信号的牌的所有者是不是当前用户玩家(有时候我们的鼠标点击了机器人玩家的牌。这样对应的牌窗口也会发出信号，所以需要进行判断)</span></span><br><span class="line">    CardPanel* panel = (CardPanel*)<span class="built_in">sender</span>();       <span class="comment">//sender()返回的是QObject类型的指针()，转换后，得到发出信号的卡牌窗口对象</span></span><br><span class="line">    <span class="keyword">if</span>(panel-&gt;<span class="built_in">getOwner</span>() != m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>())&#123;     <span class="comment">//判断发出信号的卡牌窗口的所有者，如果不是用户对象，就直接返回</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//3. 保存当前被选中的牌的窗口对象</span></span><br><span class="line">    m_curSelCard = panel;               <span class="comment">//记录在当前手牌中选择的卡牌对象</span></span><br><span class="line">    <span class="comment">//4. 判断参数的鼠标键是左键还是右键</span></span><br><span class="line">    <span class="keyword">if</span>(button == Qt::LeftButton)&#123;                 <span class="comment">//点击的是左键，就设置对应的卡牌窗口加入到准备出牌的容器中</span></span><br><span class="line">        <span class="comment">//设置扑克牌的选中状态</span></span><br><span class="line">        panel-&gt;<span class="built_in">setSeclected</span>(!panel-&gt;<span class="built_in">isSelected</span>());    <span class="comment">//设置选择状态(如果之前没有选中，经过该函数就变为选中，之前选中了，经过该函数就是不选中)</span></span><br><span class="line">        <span class="comment">//更新扑克牌在窗口中的显示</span></span><br><span class="line">        <span class="built_in">updatePlayerCards</span>(panel-&gt;<span class="built_in">getOwner</span>());</span><br><span class="line">        <span class="comment">//保存或删除扑克牌窗口对象</span></span><br><span class="line">        QSet&lt;CardPanel*&gt;::const_iterator it = m_selectCards.<span class="built_in">find</span>(panel);</span><br><span class="line">        <span class="keyword">if</span>(it == m_selectCards.<span class="built_in">constEnd</span>())&#123;</span><br><span class="line">            m_selectCards.<span class="built_in">insert</span>(panel);       <span class="comment">//没有找到，将该牌添加到容器里面</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            m_selectCards.<span class="built_in">erase</span>(it);</span><br><span class="line">        &#125;</span><br><span class="line">        m_bgm-&gt;<span class="built_in">playAssistMusic</span>(BGMControl::SelectCard);          <span class="comment">//播放出牌音乐</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(button == Qt::RightButton)&#123;            <span class="comment">//点击的是右键，就打出牌(如果不满足出牌规则，就不响应)</span></span><br><span class="line">        <span class="comment">//调用出牌按钮对应的槽函数</span></span><br><span class="line">        <span class="built_in">onUserPlayHand</span>();          <span class="comment">//调用处理用户玩家出牌函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理用户玩家出牌</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::onUserPlayHand</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//判断游戏状态</span></span><br><span class="line">    <span class="keyword">if</span>(m_gameStatus != GameControl::PlayingHand)&#123;     <span class="comment">//当前游戏状态不是出牌状态，就直接退出</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断玩家是不是用户玩家</span></span><br><span class="line">    <span class="keyword">if</span>(m_gameCtl-&gt;<span class="built_in">getCurrentPlayer</span>() != m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>())&#123;       <span class="comment">//当前玩家如果不是用户玩家，也直接返回</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断要出的牌是否为空</span></span><br><span class="line">    <span class="keyword">if</span>(m_selectCards.<span class="built_in">isEmpty</span>())&#123;         <span class="comment">//用户玩家要出的牌容器如果为空，也直接退出</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//得到要打出的牌的牌型(m_selectCards容器不为空)</span></span><br><span class="line">    Cards cs;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it=m_selectCards.<span class="built_in">begin</span>(); it!=m_selectCards.<span class="built_in">end</span>(); it++)&#123;</span><br><span class="line">        Card card = (*it)-&gt;<span class="built_in">getCard</span>();</span><br><span class="line">        cs.<span class="built_in">add</span>(card);                           <span class="comment">//将用户要打出的牌都放到Cards容器</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">PlayHand <span class="title">hand</span><span class="params">(cs)</span></span>;</span><br><span class="line">    PlayHand::HandType type = hand.<span class="built_in">getHandType</span>();           <span class="comment">//获取要打出牌的类型</span></span><br><span class="line">    <span class="keyword">if</span>(type==PlayHand::Hand_Unknown)&#123;                       <span class="comment">//如果打出的牌类型是不规则(没有定义)的，也就直接退出</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断当前玩家的牌能不能压住上一家的牌</span></span><br><span class="line">    <span class="keyword">if</span>(m_gameCtl-&gt;<span class="built_in">getPendPlayer</span>() != m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>())&#123;  <span class="comment">//先判断上一次的出牌玩家是不是用户玩家，如果不是，就不能随意出牌(要大过对方)</span></span><br><span class="line">        Cards cards = m_gameCtl-&gt;<span class="built_in">getPendCards</span>();        <span class="comment">//获取上一次的出牌玩家打出的牌</span></span><br><span class="line">        <span class="keyword">if</span>(!hand.<span class="built_in">canBeat</span>(<span class="built_in">PlayHand</span>(cards)))&#123;             <span class="comment">//判断用户玩家准备打出的牌能否击败对方的牌，不能就直接退出</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    m_countDown-&gt;<span class="built_in">stopCountDown</span>();                  <span class="comment">//出完牌了，停止倒计时</span></span><br><span class="line">    <span class="comment">//通过玩家对象出牌(调用出牌函数)</span></span><br><span class="line">    m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>()-&gt;<span class="built_in">playHand</span>(cs);      <span class="comment">//playHand()函数里面会从手牌中移除要打出的牌，并发出信号，通知主窗口接收</span></span><br><span class="line">    <span class="comment">//清空容器</span></span><br><span class="line">    m_selectCards.<span class="built_in">clear</span>();                <span class="comment">//清空用户玩家准备出牌的这个容器</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理用户玩家的放弃出牌</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::onUserPass</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_countDown-&gt;<span class="built_in">stopCountDown</span>();                     <span class="comment">//用户玩家放弃出牌，终止倒计时</span></span><br><span class="line">    <span class="comment">//判断是不是用户玩家</span></span><br><span class="line">    Player* curPlayer = m_gameCtl-&gt;<span class="built_in">getCurrentPlayer</span>();          <span class="comment">//获取当前玩家</span></span><br><span class="line">    Player* userPlayer = m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>();            <span class="comment">//获取用户玩家</span></span><br><span class="line">    <span class="keyword">if</span>(curPlayer != userPlayer)&#123;               <span class="comment">//如果当前玩家不是用户玩家，就直接退出</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断当前用户玩家是不是上一次出牌的玩家(可以不处理)</span></span><br><span class="line">    Player* pendPlayer = m_gameCtl-&gt;<span class="built_in">getPendPlayer</span>();</span><br><span class="line">    <span class="keyword">if</span>(pendPlayer==userPlayer || pendPlayer==<span class="literal">nullptr</span>)&#123; <span class="comment">//如果上一次出牌玩家是自己(其它玩家要不起出的牌)或者第一次出牌，这两种清空都直接退出(因为必须要出牌)</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//打出一个空的Cards是对象</span></span><br><span class="line">    Cards empty;</span><br><span class="line">    userPlayer-&gt;<span class="built_in">playHand</span>(empty);</span><br><span class="line">    <span class="comment">//清空用户选择的牌(玩家可能选择了一些牌，但是没有打出去)</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> it=m_selectCards.<span class="built_in">begin</span>(); it!=m_selectCards.<span class="built_in">end</span>(); it++)&#123;</span><br><span class="line">        (*it)-&gt;<span class="built_in">setSeclected</span>(<span class="literal">false</span>);         <span class="comment">//将选中的牌都设置为非选中</span></span><br><span class="line">    &#125;</span><br><span class="line">    m_selectCards.<span class="built_in">clear</span>();                  <span class="comment">//清空准备出牌容器</span></span><br><span class="line">    <span class="comment">//更新玩家待出牌区域的牌</span></span><br><span class="line">    <span class="built_in">updatePlayerCards</span>(userPlayer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//特效动画函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::showAnimation</span><span class="params">(GamePanel::AnimationType type, <span class="type">int</span> bet)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span>(type)&#123;</span><br><span class="line">    <span class="keyword">case</span> AnimationType::LianDui:</span><br><span class="line">    <span class="keyword">case</span> AnimationType::ShunZi:</span><br><span class="line">        m_animation-&gt;<span class="built_in">setFixedSize</span>(<span class="number">250</span>, <span class="number">150</span>);          <span class="comment">//设置窗口的固定大小(为图片的大小)</span></span><br><span class="line">        <span class="comment">//将子窗口移动到主窗口的某一个位置，就要用到move方法</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">move</span>((<span class="built_in">width</span>()-m_animation-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, <span class="number">200</span>);       <span class="comment">//x和y位置</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">showSequence</span>((AnimationWindow::Type)type);          <span class="comment">//调用加载动画的函数</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> AnimationType::Plane:</span><br><span class="line">        m_animation-&gt;<span class="built_in">setFixedSize</span>(<span class="number">800</span>, <span class="number">75</span>);          <span class="comment">//设置窗口的固定大小(为图片的大小)</span></span><br><span class="line">        <span class="comment">//将子窗口移动到主窗口的某一个位置，就要用到move方法</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">move</span>((<span class="built_in">width</span>()-m_animation-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, <span class="number">200</span>);       <span class="comment">//x和y位置</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">showPlane</span>();          <span class="comment">//调用加载动画的函数</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> AnimationType::Bomb:</span><br><span class="line">        m_animation-&gt;<span class="built_in">setFixedSize</span>(<span class="number">180</span>, <span class="number">200</span>);          <span class="comment">//设置窗口的固定大小(为图片的大小)</span></span><br><span class="line">        <span class="comment">//将子窗口移动到主窗口的某一个位置，就要用到move方法</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">move</span>((<span class="built_in">width</span>()-m_animation-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, (<span class="built_in">height</span>()-m_animation-&gt;<span class="built_in">height</span>())/<span class="number">2</span><span class="number">-70</span>);       <span class="comment">//x和y位置</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">showBomb</span>();          <span class="comment">//调用加载动画的函数</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> AnimationType::JokerBomb:</span><br><span class="line">        m_animation-&gt;<span class="built_in">setFixedSize</span>(<span class="number">250</span>, <span class="number">200</span>);          <span class="comment">//设置窗口的固定大小(为图片的大小)</span></span><br><span class="line">        <span class="comment">//将子窗口移动到主窗口的某一个位置，就要用到move方法</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">move</span>((<span class="built_in">width</span>()-m_animation-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, (<span class="built_in">height</span>()-m_animation-&gt;<span class="built_in">height</span>())/<span class="number">2</span><span class="number">-70</span>);       <span class="comment">//x和y位置</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">showJokerBomb</span>();          <span class="comment">//调用加载动画的函数</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> AnimationType::Bet:           <span class="comment">//如果是抢地主分数</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">setFixedSize</span>(<span class="number">160</span>, <span class="number">98</span>);          <span class="comment">//设置窗口的固定大小(为图片的大小)</span></span><br><span class="line">        <span class="comment">//将子窗口移动到主窗口的某一个位置，就要用到move方法</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">move</span>((<span class="built_in">width</span>()-m_animation-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, (<span class="built_in">height</span>()-m_animation-&gt;<span class="built_in">height</span>())/<span class="number">2</span><span class="number">-140</span>); <span class="comment">//x和y都先取中间位置，y还需要往上移</span></span><br><span class="line">        m_animation-&gt;<span class="built_in">showBetScore</span>(bet);          <span class="comment">//调用加载分数的函数</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这个主要是考虑到其它动画，因为显示分数是在2s后，会将AnimationType窗口隐藏起来，这样其它动画窗口会看不见，所以在这里调用一下显示</span></span><br><span class="line">    m_animation-&gt;<span class="built_in">show</span>();     <span class="comment">//让隐藏的窗口再显示出来</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//隐藏玩家打出的牌</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::hidePlayerDropCards</span><span class="params">(Player *player)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> it = m_contextMap.<span class="built_in">find</span>(player);          <span class="comment">//根据当前玩家得到对应的一些信息的位置(如果没有找到传进去的玩家，就返回迭代器end)</span></span><br><span class="line">    <span class="keyword">if</span>(it != m_contextMap.<span class="built_in">end</span>())&#123;                 <span class="comment">//如果it不等于end，说明找到了</span></span><br><span class="line">        <span class="keyword">if</span>(it-&gt;lastCards.<span class="built_in">isEmpty</span>())&#123;              <span class="comment">//如果为空，说明上次没有出牌</span></span><br><span class="line">            it-&gt;info-&gt;<span class="built_in">hide</span>();                     <span class="comment">//先隐藏对应的提示信息</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//Cards ---&gt; Card   注：CardList = QVector&lt;Card&gt;</span></span><br><span class="line">            CardList list = it-&gt;lastCards.<span class="built_in">toCardList</span>();             <span class="comment">//将最后打出的牌全部存入到QVector容器</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> last=list.<span class="built_in">begin</span>(); last!=list.<span class="built_in">end</span>(); last++)&#123;        <span class="comment">//遍历每一张牌</span></span><br><span class="line">                m_cardMap[*last]-&gt;<span class="built_in">hide</span>();    <span class="comment">//每一张牌都有对应的CardPanel，存到m_cardMap容器的，进行隐藏</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        it-&gt;lastCards.<span class="built_in">clear</span>();                    <span class="comment">//清空玩家最后一次打出的牌容器(不然会堆叠)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示玩家的最终得分(结束面板设置)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::showEndingScorePanel</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">bool</span> islord = m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>()-&gt;<span class="built_in">getRole</span>() == Player::Lord?<span class="literal">true</span>:<span class="literal">false</span>;     <span class="comment">//玩家是否是地主</span></span><br><span class="line">    <span class="type">bool</span> isWin = m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>()-&gt;<span class="built_in">isWin</span>();                                   <span class="comment">//玩家是否获胜</span></span><br><span class="line">    EndingPanel* panel = <span class="keyword">new</span> <span class="built_in">EndingPanel</span>(islord, isWin, <span class="keyword">this</span>);       <span class="comment">//创建一个结束面板窗口，参3的this表示在主窗口中显示</span></span><br><span class="line">    panel-&gt;<span class="built_in">show</span>();                                           <span class="comment">//显示</span></span><br><span class="line">    panel-&gt;<span class="built_in">move</span>((<span class="built_in">width</span>()-panel-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, -panel-&gt;<span class="built_in">height</span>());       <span class="comment">//结束面板刚开始显示在主窗口外(看不见)</span></span><br><span class="line">    panel-&gt;<span class="built_in">setPlayerScore</span>(m_gameCtl-&gt;<span class="built_in">getLeftRobot</span>()-&gt;<span class="built_in">getScore</span>(),</span><br><span class="line">                          m_gameCtl-&gt;<span class="built_in">getRightRobot</span>()-&gt;<span class="built_in">getScore</span>(),</span><br><span class="line">                          m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>()-&gt;<span class="built_in">getScore</span>());</span><br><span class="line">    <span class="comment">//根据玩家的输赢来播放对应的音乐</span></span><br><span class="line">    <span class="keyword">if</span>(isWin)&#123;</span><br><span class="line">        m_bgm-&gt;<span class="built_in">playEndingMusic</span>(<span class="literal">true</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        m_bgm-&gt;<span class="built_in">playEndingMusic</span>(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//设置结束面板的动画效果</span></span><br><span class="line">    QPropertyAnimation *animation = <span class="keyword">new</span> <span class="built_in">QPropertyAnimation</span>(panel, <span class="string">&quot;geometry&quot;</span>, <span class="keyword">this</span>);   <span class="comment">//参1：给哪个对象指定动画效果；参3：父对象</span></span><br><span class="line">    <span class="comment">//动画持续时间</span></span><br><span class="line">    animation-&gt;<span class="built_in">setDuration</span>(<span class="number">1500</span>);           <span class="comment">//1.5s</span></span><br><span class="line">    <span class="comment">//设置窗口的起始位置和终止位置</span></span><br><span class="line">    animation-&gt;<span class="built_in">setStartValue</span>(<span class="built_in">QRect</span>(panel-&gt;<span class="built_in">x</span>(), panel-&gt;<span class="built_in">y</span>(), panel-&gt;<span class="built_in">width</span>(), panel-&gt;<span class="built_in">height</span>()));</span><br><span class="line">    animation-&gt;<span class="built_in">setEndValue</span>(<span class="built_in">QRect</span>((<span class="built_in">width</span>()-panel-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, (<span class="built_in">height</span>()-panel-&gt;<span class="built_in">height</span>())/<span class="number">2</span>, panel-&gt;<span class="built_in">width</span>(), panel-&gt;<span class="built_in">height</span>()));</span><br><span class="line">    <span class="comment">//设置窗口的运动曲线</span></span><br><span class="line">    animation-&gt;<span class="built_in">setEasingCurve</span>(<span class="built_in">QEasingCurve</span>(QEasingCurve::OutBounce));</span><br><span class="line">    <span class="comment">//播放动画效果</span></span><br><span class="line">    animation-&gt;<span class="built_in">start</span>();</span><br><span class="line">    <span class="comment">//处理窗口信号(当点击继续游戏按钮，就会发出continueGame信号，然后这里也会接收该信号)</span></span><br><span class="line">    <span class="built_in">connect</span>(panel, &amp;EndingPanel::continueGame, <span class="keyword">this</span>, [=]()&#123;</span><br><span class="line">        panel-&gt;<span class="built_in">close</span>();                  <span class="comment">//关闭结束界面窗口，但没有析构(但由于指定了父对象，所以的父对象没有结束，也就不会析构panel)</span></span><br><span class="line">        panel-&gt;<span class="built_in">deleteLater</span>();            <span class="comment">//手动析构panel结束界面窗口</span></span><br><span class="line">        animation-&gt;<span class="built_in">deleteLater</span>();        <span class="comment">//手动析构动画对象</span></span><br><span class="line">        ui-&gt;btnGroup-&gt;<span class="built_in">selectPanel</span>(ButtonGroup::Empty);               <span class="comment">//按钮组隐藏，显示空按钮的按钮组</span></span><br><span class="line">        <span class="built_in">gameStatusPrecess</span>(GameControl::DispatchCard);                <span class="comment">//将游戏状态设置位发牌状态</span></span><br><span class="line">        m_bgm-&gt;<span class="built_in">startBGM</span>(<span class="number">80</span>);              <span class="comment">//播放背景音乐(开始)</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::initCountDown</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    m_countDown = <span class="keyword">new</span> <span class="built_in">CountDown</span>(<span class="keyword">this</span>);                <span class="comment">//创建一个闹钟类对象，父对象为主窗口</span></span><br><span class="line">    m_countDown-&gt;<span class="built_in">move</span>((<span class="built_in">width</span>()-m_countDown-&gt;<span class="built_in">width</span>())/<span class="number">2</span>, (<span class="built_in">height</span>()-m_countDown-&gt;<span class="built_in">height</span>())/<span class="number">2</span>+<span class="number">30</span>);    <span class="comment">//显示位置</span></span><br><span class="line">    <span class="built_in">connect</span>(m_countDown, &amp;CountDown::notMuchTime, <span class="keyword">this</span>, [=]()&#123;             <span class="comment">//当闹钟秒数减为5s时,会发出信号</span></span><br><span class="line">        <span class="comment">//播放提示音乐</span></span><br><span class="line">        m_bgm-&gt;<span class="built_in">playAssistMusic</span>(BGMControl::Alert);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">connect</span>(m_countDown, &amp;CountDown::timeout, <span class="keyword">this</span>, &amp;GamePanel::onUserPass); <span class="comment">//当秒数减为0s时，会发出信号，执行的槽函数当放弃出牌情况处理</span></span><br><span class="line">    UserPlayer* userPlayer = m_gameCtl-&gt;<span class="built_in">getUserPlayer</span>();               <span class="comment">//得到用户对象</span></span><br><span class="line">    <span class="built_in">connect</span>(userPlayer, &amp;UserPlayer::startCountDown, <span class="keyword">this</span>, [=]()&#123;              <span class="comment">//当用户玩家准备出牌时，会发出信号startCountDown</span></span><br><span class="line">        <span class="comment">//要在主屏幕上显示闹钟，必须是用户玩家可以放弃出牌的情况，比如说上一次出牌玩家不是自己且不是第一次刚开始出牌</span></span><br><span class="line">        <span class="keyword">if</span>(m_gameCtl-&gt;<span class="built_in">getPendPlayer</span>()!=userPlayer &amp;&amp; m_gameCtl-&gt;<span class="built_in">getPendPlayer</span>()!=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            m_countDown-&gt;<span class="built_in">showCountDown</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::paintEvent</span><span class="params">(QPaintEvent *ev)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(ev);</span><br><span class="line">    <span class="function">QPainter <span class="title">p</span><span class="params">(<span class="keyword">this</span>)</span></span>;</span><br><span class="line">    p.<span class="built_in">drawPixmap</span>(<span class="built_in">rect</span>(),m_bkImage);         <span class="comment">//参数：窗口矩形区域、</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">GamePanel::mouseMoveEvent</span><span class="params">(QMouseEvent *ev)</span>          <span class="comment">//鼠标移动过程中框选多张扑克牌</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">Q_UNUSED</span>(ev);</span><br><span class="line">    <span class="comment">//ev-&gt;buttons()里面有多种鼠标按住的移动方式(如左键、右键等)</span></span><br><span class="line">    <span class="keyword">if</span>(ev-&gt;<span class="built_in">buttons</span>() &amp; Qt::LeftButton)&#123;                 <span class="comment">//判断一下是否有鼠标左键(大于0说明左键参与了行动)</span></span><br><span class="line">        QPoint pt = ev-&gt;<span class="built_in">pos</span>();                         <span class="comment">//得到鼠标在窗口中的位置</span></span><br><span class="line">        <span class="keyword">if</span>(!m_cardsRect.<span class="built_in">contains</span>(pt))&#123;               <span class="comment">//如果pt不在出牌区域</span></span><br><span class="line">            m_curSelCard = <span class="literal">nullptr</span>;                  <span class="comment">//将鼠标选择的卡牌窗口置为nullptr</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;                                                      <span class="comment">//如果鼠标按住的位置在卡牌区域，就要找到是哪些卡牌</span></span><br><span class="line">            QList&lt;CardPanel*&gt; list = m_userCards.<span class="built_in">keys</span>();</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;list.<span class="built_in">size</span>(); i++)&#123;</span><br><span class="line">                CardPanel* panel = list.<span class="built_in">at</span>(i);</span><br><span class="line">                <span class="keyword">if</span>(m_userCards[panel].<span class="built_in">contains</span>(pt) &amp;&amp; m_curSelCard!=panel)&#123;  <span class="comment">//如果找到对应卡牌，且如果一直在一张卡牌上面，也只模拟点击一次</span></span><br><span class="line">                    <span class="comment">//点击这张扑克牌(模拟点击效果)</span></span><br><span class="line">                    panel-&gt;<span class="built_in">clicked</span>();       <span class="comment">//该函数会发出一个信号，接收者是GamePanel</span></span><br><span class="line">                    m_curSelCard = panel;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="6-游戏的启动过程"><a href="#6-游戏的启动过程" class="headerlink" title="6. 游戏的启动过程"></a>6. 游戏的启动过程</h1><blockquote>
<p> 在这个斗地主的小游戏中，虽然创建了许多类对象，但基本上会在主窗口类中做初始化，并实现各个类的功能，将每个类的功能结合在一起，就实现了单机版的斗地主小游戏。</p>
</blockquote>
<p>首先是在主窗口类<code>GamePanel</code>中，设置了主窗口的左上角标题和窗口大小，又往主窗口中加载了背景图，背景图有9张，每次启动游戏随机取1张。</p>
<p>在<code>initButtonsGroup()</code>函数中先初始化5个页面的按钮组，选择初始界面的按钮组为开始界面，即只有一个开始按钮。然后通过信号槽机制，当点击开始按钮后，就执行匿名函数(发牌操作)。这个匿名函数会切换按钮组窗口，切换成空按钮的窗口，将所有玩家的得分清0，然后又马上更新每个玩家的得分。通过函数<code>gameStatusPrecess()</code>将游戏状态改为发牌状态。在<code>gameStatusPrecess()</code>函数里，因为传进来的参数是发牌状态的参数，通过switch执行对应的状态分支，即开始发牌函数<code>startDispatchCard()</code>。在该开始发牌函数中，它会设置各个玩家和扑克牌在窗口中显示的一些属性，如玩家的头像显示、玩家的手牌是否可见以及正中间的卡牌。同时，在这个函数中，也启动了一个定时器，该定时器每隔10毫秒会发送一次，该定时器是定义在主窗口类GamePanel的构造函数中的，它是每隔固定时间会执行发牌函数<code>onDispatchCard()</code>，这个函数中，是慢慢移动卡牌位置，然后利用定时器实现一个动态的发牌效果，当还剩下3张牌时，停止定时器，通过函数<code>gameStatusPrecess()</code>切换游戏状态为叫地主状态。在该状态下，通过switch执行了对应的分支。在该分支下，先是将3张底牌隐藏起来，然后调用游戏控制类的开始叫地主<code>startLordCard()</code>函数。这个函数里面执行了从父类继承下来的虚函数<code>prepareCallLord()</code>，机器人玩家和用户玩家作为子类，它们实现的操作不一样。首先是用户玩家，用户玩家在这个虚函数里面没有执行任何操作，然后又向主窗口发出了信号<code>playerStatusChanged</code>，主窗口类的<code>gameControlInit()</code>函数里面通过connect来处理该信号，令<code>onPlayerStatusChanged()</code>槽函数执行相应操作。在该函数里，会先判断是否是用户玩家，如果是用户玩家，就切换按钮组窗口，切换叫地主的一些按钮出来。</p>
<p>用户玩家的叫地主按钮显示出来后，又回到了<code>initButtonsGroup()</code>函数，在该函数，通过信号槽机制connect设置，当点击对应下注按钮时，会携带对应的分数执行匿名函数，在这个匿名函数中，因为用户玩家已经下注了，所以就切换按钮组窗口，切换为空按钮组。同时它会执行Player类的<code>grabLordBet()</code>函数，这个函数会发出信号<code>notifyGrabLordBet</code>，在发出该信号后，在主窗口的构造函数中，游戏控制类初始化函数<code>gameControlInit()</code>里面执行的<code>playerInit()</code>函数，在该函数里面会通过信号槽机制connect来接收信号，并执行槽函数<code>onGrabBet()</code>，在这个函数里面，它会根据用户玩家的下注分数，来判断是否还需要继续执行抢地主的操作，大概有两种情况：</p>
<p>1.用户玩家按的按钮是不抢地主、下注1分或下注2分，这些情况都说明还需要继续执行抢地主状态，就发送一个信号<code>notifyGrabLordBet</code>，主窗口函数会在构造函数的<code>gameControlInit()</code>函数里面通过信号槽来接收处理，执行槽函数<code>onGrabLordBet()</code>，这个函数里面就是显示提示信息和播放对应的背景音乐。然后回到<code>onGrabBet()</code>函数，它会切换玩家，将下一个玩家更新为当前玩家，并向主窗口发出信号<code>playerStatusChanged</code>，主窗口接收该信号后执行的槽函数中，通过switch执行对应的抢地主分支，而抢地主分支是只有用户玩家时，才会切换出叫地主的按钮组，不是用户玩家，就什么都不执行，退出即可。然后回到onGrabBet()函数，通过当前玩家(机器人玩家)对象调用准备叫地主函数<code>prepareCallLord()</code>。在机器人玩家类中，重写的这个函数里面会创建一个叫地主的子线程，该子线程会先睡眠2s(模拟思考效果)，然后执行考虑叫地主函数<code>thinkCallLord()</code>，在该函数里，会分析对应机器人玩家的手牌情况，看是否满足叫地主的条件，通过最后计算出来的权重来断定下注多数分。然后发送信号<code>notifyGrabLordBet</code>，游戏控制类接受信号并执行槽函数<code>onGrabBet()</code>，在这个函数如果不满足某些条件，就会继续切换下一个玩家叫地主，依次下去。当满足一定条件时，就会确定地主玩家，执行成为地主函数<code>becomeLord()</code>。</p>
<p>2.用户玩家下注3分，直接成为地主，执行函数<code>becomeLord()</code>。</p>
<p>在<code>becomeLord()</code>函数中，先是设置各个玩家的身份，将当前地主身份的玩家设置为当前玩家(先出牌)，又将三张底牌添加到地主玩家的手牌中。然后这定义了一个定时器，每隔1s就发送信号<code>gameStatusChanged</code>和<code>playerStatusChanged</code>。其中由主窗口接收信号<code>gameStatusChanged</code>，执行槽函数<code>gameStatusPrecess()</code>，这个槽函数里面就是通过switch语句执行对应的分支，该分支下主要就是将底牌、中间的发牌隐藏、提示信息等，和显示玩家带身份的头像；主窗口也接收<code>playerStatusChanged</code>信号，并执行槽函数<code>onPlayerStatusChanged()</code>，通过执行对应的分支，该分支主要就是判断当前是否是用户玩家，如果是用户玩家，就切换按钮组窗口为出牌情况，不是的话就切换为空按钮主窗口。在处理完两个信号的槽函数后，在定时器中又调用了对应玩家的出牌函数<code>preparePlayHand()</code>，这个出牌函数是用户玩家和机器人玩家执行的程序不一样，用户玩家就执行发出一条信号<code>startCountDown</code>，用于出牌倒计时即可；机器人玩家会创建对应的出牌子线程，在子线程中会执行考虑出牌函数<code>thinkPlayHand()</code>，接下来就是小项目中设定的一些策略了，机器人玩家在什么情况下出什么样的牌。</p>
<h1 id="7-游戏效果"><a href="#7-游戏效果" class="headerlink" title="7. 游戏效果"></a>7. 游戏效果</h1><p>当点击启动程序时，会先显示一个加载的界面，如下图：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_13.png"></p>
<p>当加载页面完成后，就会出现游戏场景的页面了，在这个页面中右上角显示的是个玩家的分数，因为才启动程序，所以都是0分。场景的正中间是发卡牌的扑克牌，下面是开始按钮。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_14.png"></p>
<p>当点击开始游戏按钮后，就进入了发牌阶段，只有用户玩家的手牌是显示正面的，其它两个机器人玩家的手牌是显示背面的。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_15.png"></p>
<p>当发牌结束后，就游戏就进入了叫地主状态，当用户玩家直接点击3分按钮后，就可以直接成为地主，结束叫地主状态。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_16.png"></p>
<p>而当用户玩家点击除3分按钮的其它按钮，就会轮到下一个(机器人)玩家考虑是否叫地主。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_17.png"></p>
<p>当3个玩家都下注后，最后由下注分数最大的玩家当地主，其它两个玩家作为农民。并且三张底牌显示在正上方。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_18.png"></p>
<p>叫地主状态结束后，用鼠标选择卡牌，点击出牌即可。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_19.png"></p>
<p>当出的牌是一些特殊牌型，如炸弹、飞机、顺子等，还会有特效出现。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_20.png"></p>
<p>当某个玩家出完牌后，表示胜利，然后正中间出现结束面板，显示当前三个玩家的得分，同时右上角也显示当前三个玩家的得分。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_21.png"></p>
<p>当点击继续游戏按钮时，可以马上又进入下一局游戏，主窗口的右上角依然保存三个玩家的得分。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/lxx93/tuchuang@main/picture/project/6_22.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://lxx93.online">lxx9339-T</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://lxx93.online/2024/08/08/Qt%E6%96%97%E5%9C%B0%E4%B8%BB%E9%A1%B9%E7%9B%AE(%E4%B8%8B)/">https://lxx93.online/2024/08/08/Qt斗地主项目(下)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lxx93.online" target="_blank">-lxxl-</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Qt/">Qt</a><a class="post-meta__tags" href="/tags/c/">c++</a></div><div class="post_share"><div class="social-share" data-image="/img/23.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/08/20/Http%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%A1%B9%E7%9B%AE/" title="Http高并发服务器项目"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/22.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Http高并发服务器项目</div></div></a></div><div class="next-post pull-right"><a href="/2024/08/04/Qt%E6%96%97%E5%9C%B0%E4%B8%BB%E9%A1%B9%E7%9B%AE(%E4%B8%8A)/" title="Qt斗地主项目(上)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/21.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Qt斗地主项目(上)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/08/04/Qt%E6%96%97%E5%9C%B0%E4%B8%BB%E9%A1%B9%E7%9B%AE(%E4%B8%8A)/" title="Qt斗地主项目(上)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/21.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-04</div><div class="title">Qt斗地主项目(上)</div></div></a></div><div><a href="/2024/08/03/QT%E5%9F%BA%E7%A1%80/" title="QT基础"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/20.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-03</div><div class="title">QT基础</div></div></a></div><div><a href="/2024/08/02/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B(%E4%B8%8B)/" title="c++并发编程(下)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/19.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-02</div><div class="title">c++并发编程(下)</div></div></a></div><div><a href="/2024/07/25/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B(%E4%B8%8A)/" title="c++并发编程(上)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/16.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-25</div><div class="title">c++并发编程(上)</div></div></a></div><div><a href="/2024/07/28/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B(%E4%B8%AD)/" title="c++并发编程(中)"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/18.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-28</div><div class="title">c++并发编程(中)</div></div></a></div><div><a href="/2024/08/26/%E6%96%B0%E7%89%B9%E6%80%A7c++11/" title="新特性c++11"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/24.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-26</div><div class="title">新特性c++11</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/avater.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">lxx9339-T</div><div class="author-info__description">即使身处阴沟,也能仰望星空。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">56</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">11</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2235221711@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=2235221711&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%BB%93%E6%9D%9F%E9%9D%A2%E6%9D%BF%E7%AA%97%E5%8F%A3%E7%B1%BBEndingPanel"><span class="toc-text">1. 结束面板窗口类EndingPanel</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-EndingPanel%E7%B1%BB%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-text">1.1 EndingPanel类头文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-EndingPanel%E7%B1%BB%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0"><span class="toc-text">1.2 EndingPanel类函数实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%8A%A8%E7%94%BB%E6%95%88%E6%9E%9C%E7%B1%BBAnimationWindow"><span class="toc-text">2. 动画效果类AnimationWindow</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-AnimationWindow%E7%B1%BB%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-text">2.1 AnimationWindow类头文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-AnimationWindow%E7%B1%BB%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0"><span class="toc-text">2.2 AnimationWindow类函数实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E9%97%B9%E9%92%9F%E7%AA%97%E5%8F%A3%E7%B1%BBCountDown"><span class="toc-text">3. 闹钟窗口类CountDown</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-CountDown%E7%B1%BB%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-text">3.1 CountDown类头文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-CountDown%E7%B1%BB%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0"><span class="toc-text">3.2 CountDown类函数实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E8%83%8C%E6%99%AF%E9%9F%B3%E4%B9%90%E7%B1%BBBGMControl"><span class="toc-text">4. 背景音乐类BGMControl</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-BGMControl%E7%B1%BB%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-text">4.1 BGMControl类头文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-BGMControl%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0"><span class="toc-text">4.2 BGMControl函数实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E6%B8%B8%E6%88%8F%E4%B8%BB%E7%AA%97%E5%8F%A3%E7%B1%BBGamePanel"><span class="toc-text">5. 游戏主窗口类GamePanel</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-GamePanel%E7%B1%BB%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="toc-text">5.1 GamePanel类头文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-GamePanel%E7%B1%BB%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0"><span class="toc-text">5.2 GamePanel类函数实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E6%B8%B8%E6%88%8F%E7%9A%84%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B"><span class="toc-text">6. 游戏的启动过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E6%B8%B8%E6%88%8F%E6%95%88%E6%9E%9C"><span class="toc-text">7. 游戏效果</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/09/05/bbb/" title="bbb"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/one.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="bbb"/></a><div class="content"><a class="title" href="/2024/09/05/bbb/" title="bbb">bbb</a><time datetime="2024-09-05T14:04:58.000Z" title="发表于 2024-09-05 22:04:58">2024-09-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/03/%E8%81%8A%E5%A4%A9%E9%A1%B9%E7%9B%AEc++%E5%85%A8%E6%A0%88/" title="聊天项目c++全栈"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/26.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="聊天项目c++全栈"/></a><div class="content"><a class="title" href="/2024/09/03/%E8%81%8A%E5%A4%A9%E9%A1%B9%E7%9B%AEc++%E5%85%A8%E6%A0%88/" title="聊天项目c++全栈">聊天项目c++全栈</a><time datetime="2024-09-03T07:34:24.000Z" title="发表于 2024-09-03 15:34:24">2024-09-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8Fc++/" title="设计模式c++"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/25.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式c++"/></a><div class="content"><a class="title" href="/2024/08/29/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8Fc++/" title="设计模式c++">设计模式c++</a><time datetime="2024-08-29T07:34:24.000Z" title="发表于 2024-08-29 15:34:24">2024-08-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/26/%E6%96%B0%E7%89%B9%E6%80%A7c++11/" title="新特性c++11"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/24.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="新特性c++11"/></a><div class="content"><a class="title" href="/2024/08/26/%E6%96%B0%E7%89%B9%E6%80%A7c++11/" title="新特性c++11">新特性c++11</a><time datetime="2024-08-26T10:34:13.000Z" title="发表于 2024-08-26 18:34:13">2024-08-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/08/20/Http%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%A1%B9%E7%9B%AE/" title="Http高并发服务器项目"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/22.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Http高并发服务器项目"/></a><div class="content"><a class="title" href="/2024/08/20/Http%E9%AB%98%E5%B9%B6%E5%8F%91%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%A1%B9%E7%9B%AE/" title="Http高并发服务器项目">Http高并发服务器项目</a><time datetime="2024-08-20T14:09:56.000Z" title="发表于 2024-08-20 22:09:56">2024-08-20</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2024  <i id="heartbeat" class="fa fas fa-heartbeat"></i> lxx9339-T</div><div class="footer_custom_text"><p> <a style="margin-inline:5px"target="_blank" href="https://hexo.io/"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&logo=hexo" title="博客框架为 Hexo" alt="HEXO"> </a> <a style="margin-inline:5px"target="_blank" href="https://butterfly.js.org/"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&logo=bitdefender" title="主题采用 Butterfly" alt="Butterfly"> </a> <a style="margin-inline:5px"target="_blank" href="https://github.com/"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&logo=GitHub" title="本站项目由 GitHub 托管" alt="GitHub"> </a> <a style="margin-inline:5px"target="_blank"href="http://creativecommons.org/licenses/by-nc-sa/4.0/"> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&logo=Claris" alt="img" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"> </a> </p></div></div><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.8.8/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.lxx93.online/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.lxx93.online/',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))

    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(init,0)
    else getScript('https://cdn.jsdelivr.net/npm/twikoo@1.6.31/dist/twikoo.all.min.js').then(init)
  }

  if ('Twikoo' === 'Twikoo' || !true       //软加载打开，可以提高网址性能) {
    if (true       //软加载打开，可以提高网址性能) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><div class="aplayer no-destroy" data-id="12221117397" data-server="netease" data-type="playlist"   data-order="list" data-fixed="true" data-preload="auto" data-autoplay="false" data-mutex="true" ></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script> - <script data-pjax defer src="https://npm.elemecdn.com/tzy-blog/lib/js/theme/chocolate.js"></script><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/metingjs/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener
  btf.removeGlobalFnEvent('pjax')
  btf.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_anzhiyu_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock_anzhiyu')
    if(parent_div_git) {
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var qweather_key = 'a24c62babc5b484d932b02c4747b0f56';
  var gaud_map_key = '9bcdd4b88228b310aa9787a1153666fd';
  var baidu_ak_key = 'undefined';
  var flag = 0;
  var clock_rectangle = '103.719156,36.104195';
  var clock_default_rectangle_enable = 'true';

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_anzhiyu_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_anzhiyu_injector_config();
  }
  </script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script data-pjax src="https://cdn.cbd.int/hexo-butterfly-clock-anzhiyu@1.1.6/lib/clock.min.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('flink-list-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('article-sort-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__slideInRight');
    arr[i].setAttribute('data-wow-duration', '1.5s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__flipInY');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script><script async="async">var arr = document.getElementsByClassName('site-card');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__animated');
    arr[i].setAttribute('data-wow-duration', '3s');
    arr[i].setAttribute('data-wow-delay', '');
    arr[i].setAttribute('data-wow-offset', '');
    arr[i].setAttribute('data-wow-iteration', '');
  }</script></div><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://cdn.cbd.int/hexo-butterfly-wowjs/lib/wow_init.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/"});</script></body></html>